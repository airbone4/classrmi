<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>test for class</title>
  <meta name="description" content="web article test">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="test for class" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="web article test" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="test for class" />
  
  <meta name="twitter:description" content="web article test" />
  

<meta name="author" content="lend jwj cen">


<meta name="date" content="2018-10-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="file-system.html">
<link rel="next" href="r-packages.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="adv-r.css" type="text/css" />
<link rel="stylesheet" href="tableStyle.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">testing </a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> 網路資源</a></li>
<li class="chapter" data-level="2" data-path="file-system.html"><a href="file-system.html"><i class="fa fa-check"></i><b>2</b> File System</a><ul>
<li class="chapter" data-level="2.1" data-path="file-system.html"><a href="file-system.html#exploring-file-system"><i class="fa fa-check"></i><b>2.1</b> Exploring file system</a></li>
<li class="chapter" data-level="2.2" data-path="file-system.html"><a href="file-system.html#creating-of-a-directory"><i class="fa fa-check"></i><b>2.2</b> Creating of a directory</a></li>
<li class="chapter" data-level="2.3" data-path="file-system.html"><a href="file-system.html#r"><i class="fa fa-check"></i><b>2.3</b> R系統檔案列表</a></li>
<li class="chapter" data-level="2.4" data-path="file-system.html"><a href="file-system.html#constructing-of-file-names-in-r"><i class="fa fa-check"></i><b>2.4</b> Constructing of file names in R</a><ul>
<li class="chapter" data-level="2.4.1" data-path="file-system.html"><a href="file-system.html#note-about-windows"><i class="fa fa-check"></i><b>2.4.1</b> Note about Windows</a></li>
<li class="chapter" data-level="2.4.2" data-path="file-system.html"><a href="file-system.html#section-2.4.2"><i class="fa fa-check"></i><b>2.4.2</b> 和工作區相關的指令</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>3</b> Functions</a><ul>
<li class="chapter" data-level="3.1" data-path="functions.html"><a href="functions.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#outline"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>3.2</b> Function fundamentals</a><ul>
<li class="chapter" data-level="3.2.1" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>3.2.1</b> First-class functions</a></li>
<li class="chapter" data-level="3.2.2" data-path="functions.html"><a href="functions.html#function-components"><i class="fa fa-check"></i><b>3.2.2</b> Function components</a></li>
<li class="chapter" data-level="3.2.3" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>3.2.3</b> Primitive functions</a></li>
<li class="chapter" data-level="3.2.4" data-path="functions.html"><a href="functions.html#exercises"><i class="fa fa-check"></i><b>3.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>3.3</b> Lexical scoping</a><ul>
<li class="chapter" data-level="3.3.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>3.3.1</b> Name masking</a></li>
<li class="chapter" data-level="3.3.2" data-path="functions.html"><a href="functions.html#functions-vs.variables"><i class="fa fa-check"></i><b>3.3.2</b> Functions vs. variables</a></li>
<li class="chapter" data-level="3.3.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>3.3.3</b> A fresh start</a></li>
<li class="chapter" data-level="3.3.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>3.3.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="3.3.5" data-path="functions.html"><a href="functions.html#exercises-1"><i class="fa fa-check"></i><b>3.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>3.4</b> Lazy evaluation</a><ul>
<li class="chapter" data-level="3.4.1" data-path="functions.html"><a href="functions.html#forcing-evaluation"><i class="fa fa-check"></i><b>3.4.1</b> Forcing evaluation</a></li>
<li class="chapter" data-level="3.4.2" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>3.4.2</b> Promises</a></li>
<li class="chapter" data-level="3.4.3" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>3.4.3</b> Default arguments</a></li>
<li class="chapter" data-level="3.4.4" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>3.4.4</b> Missing arguments</a></li>
<li class="chapter" data-level="3.4.5" data-path="functions.html"><a href="functions.html#exercises-2"><i class="fa fa-check"></i><b>3.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>3.5</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="3.5.1" data-path="functions.html"><a href="functions.html#exercises-3"><i class="fa fa-check"></i><b>3.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>3.6</b> Exiting a function</a><ul>
<li class="chapter" data-level="3.6.1" data-path="functions.html"><a href="functions.html#implicit-vs.explict-returns"><i class="fa fa-check"></i><b>3.6.1</b> Implicit vs. explict returns</a></li>
<li class="chapter" data-level="3.6.2" data-path="functions.html"><a href="functions.html#invisible-values"><i class="fa fa-check"></i><b>3.6.2</b> Invisible values</a></li>
<li class="chapter" data-level="3.6.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>3.6.3</b> Errors</a></li>
<li class="chapter" data-level="3.6.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>3.6.4</b> Exit handlers</a></li>
<li class="chapter" data-level="3.6.5" data-path="functions.html"><a href="functions.html#exercises-4"><i class="fa fa-check"></i><b>3.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>3.7</b> Function forms</a><ul>
<li class="chapter" data-level="3.7.1" data-path="functions.html"><a href="functions.html#rewriting-to-prefix-form"><i class="fa fa-check"></i><b>3.7.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="3.7.2" data-path="functions.html"><a href="functions.html#prefix-form-prefix-form"><i class="fa fa-check"></i><b>3.7.2</b> Prefix form {prefix-form}</a></li>
<li class="chapter" data-level="3.7.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>3.7.3</b> Infix functions</a></li>
<li class="chapter" data-level="3.7.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>3.7.4</b> Replacement functions</a></li>
<li class="chapter" data-level="3.7.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>3.7.5</b> Special forms</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>3.8</b> Invoking a function</a><ul>
<li class="chapter" data-level="3.8.1" data-path="functions.html"><a href="functions.html#exercises-5"><i class="fa fa-check"></i><b>3.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>3.9</b> Quiz answers</a></li>
<li class="chapter" data-level="3.10" data-path="functions.html"><a href="functions.html#quick-view"><i class="fa fa-check"></i><b>3.10</b> quick view</a><ul>
<li class="chapter" data-level="3.10.1" data-path="functions.html"><a href="functions.html#section-3.10.1"><i class="fa fa-check"></i><b>3.10.1</b> 編輯/瀏覽資料</a></li>
<li class="chapter" data-level="3.10.2" data-path="functions.html"><a href="functions.html#section-3.10.2"><i class="fa fa-check"></i><b>3.10.2</b> 個別欄位</a></li>
<li class="chapter" data-level="3.10.3" data-path="functions.html"><a href="functions.html#section-3.10.3"><i class="fa fa-check"></i><b>3.10.3</b> 質性數據的分析</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="r-packages.html"><a href="r-packages.html"><i class="fa fa-check"></i><b>4</b> R Packages</a><ul>
<li class="chapter" data-level="4.1" data-path="r-packages.html"><a href="r-packages.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 基本</a><ul>
<li class="chapter" data-level="4.1.1" data-path="r-packages.html"><a href="r-packages.html#reference"><i class="fa fa-check"></i><b>4.1.1</b> reference</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="r-packages.html"><a href="r-packages.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 範例解析</a><ul>
<li class="chapter" data-level="4.2.1" data-path="r-packages.html"><a href="r-packages.html#test"><i class="fa fa-check"></i><b>4.2.1</b> test</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="r-packages.html"><a href="r-packages.html#debug"><i class="fa fa-check"></i><b>4.3</b> 測試debug</a></li>
<li class="chapter" data-level="4.4" data-path="r-packages.html"><a href="r-packages.html#-package-"><i class="fa fa-check"></i><b>4.4</b> 自製 package 範例</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-type.html"><a href="data-type.html"><i class="fa fa-check"></i><b>5</b> data type</a><ul>
<li class="chapter" data-level="5.1" data-path="data-type.html"><a href="data-type.html#section-5.1"><i class="fa fa-check"></i><b>5.1</b> 基本操作</a><ul>
<li class="chapter" data-level="5.1.1" data-path="data-type.html"><a href="data-type.html#section-5.1.1"><i class="fa fa-check"></i><b>5.1.1</b> 指派</a></li>
<li class="chapter" data-level="5.1.2" data-path="data-type.html"><a href="data-type.html#section-5.1.2"><i class="fa fa-check"></i><b>5.1.2</b> 資源</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="data-type.html"><a href="data-type.html#section-5.2"><i class="fa fa-check"></i><b>5.2</b> 介紹</a></li>
<li class="chapter" data-level="5.3" data-path="data-type.html"><a href="data-type.html#section-5.3"><i class="fa fa-check"></i><b>5.3</b> 實數的比較</a></li>
<li class="chapter" data-level="5.4" data-path="data-type.html"><a href="data-type.html#section-5.4"><i class="fa fa-check"></i><b>5.4</b> 字串</a><ul>
<li class="chapter" data-level="5.4.1" data-path="data-type.html"><a href="data-type.html#section-5.4.1"><i class="fa fa-check"></i><b>5.4.1</b> 建立字串</a></li>
<li class="chapter" data-level="5.4.2" data-path="data-type.html"><a href="data-type.html#section-5.4.2"><i class="fa fa-check"></i><b>5.4.2</b> 空字串</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="data-type.html"><a href="data-type.html#is-family"><i class="fa fa-check"></i><b>5.5</b> 型態操作is family</a></li>
<li class="chapter" data-level="5.6" data-path="data-type.html"><a href="data-type.html#vector"><i class="fa fa-check"></i><b>5.6</b> vector</a><ul>
<li class="chapter" data-level="5.6.1" data-path="data-type.html"><a href="data-type.html#section-5.6.1"><i class="fa fa-check"></i><b>5.6.1</b> 練習範例</a></li>
<li class="chapter" data-level="5.6.2" data-path="data-type.html"><a href="data-type.html#vector-"><i class="fa fa-check"></i><b>5.6.2</b> vector 相關的運算</a></li>
<li class="chapter" data-level="5.6.3" data-path="data-type.html"><a href="data-type.html#vector"><i class="fa fa-check"></i><b>5.6.3</b> 如何存取vector中的元素</a></li>
<li class="chapter" data-level="5.6.4" data-path="data-type.html"><a href="data-type.html#section-5.6.4"><i class="fa fa-check"></i><b>5.6.4</b> 邏輯做為索引</a></li>
<li class="chapter" data-level="5.6.5" data-path="data-type.html"><a href="data-type.html#-character-vector-"><i class="fa fa-check"></i><b>5.6.5</b> 利用字串( character vector) 作為索引</a></li>
<li class="chapter" data-level="5.6.6" data-path="data-type.html"><a href="data-type.html#how-to-modify-a-vector-in-r"><i class="fa fa-check"></i><b>5.6.6</b> How to modify a vector in R?</a></li>
<li class="chapter" data-level="5.6.7" data-path="data-type.html"><a href="data-type.html#how-to-delete-a-vector"><i class="fa fa-check"></i><b>5.6.7</b> How to delete a Vector?</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="data-type.html"><a href="data-type.html#list"><i class="fa fa-check"></i><b>5.7</b> List</a><ul>
<li class="chapter" data-level="5.7.1" data-path="data-type.html"><a href="data-type.html#creating-a-list"><i class="fa fa-check"></i><b>5.7.1</b> Creating a List</a></li>
<li class="chapter" data-level="5.7.2" data-path="data-type.html"><a href="data-type.html#accessing-list-elements"><i class="fa fa-check"></i><b>5.7.2</b> Accessing List Elements</a></li>
<li class="chapter" data-level="5.7.3" data-path="data-type.html"><a href="data-type.html#manipulating-list-elements"><i class="fa fa-check"></i><b>5.7.3</b> Manipulating List Elements</a></li>
<li class="chapter" data-level="5.7.4" data-path="data-type.html"><a href="data-type.html#merging-lists"><i class="fa fa-check"></i><b>5.7.4</b> Merging Lists</a></li>
<li class="chapter" data-level="5.7.5" data-path="data-type.html"><a href="data-type.html#converting-list-to-vector"><i class="fa fa-check"></i><b>5.7.5</b> Converting List to Vector</a></li>
<li class="chapter" data-level="5.7.6" data-path="data-type.html"><a href="data-type.html#vector-list"><i class="fa fa-check"></i><b>5.7.6</b> 比較vector, list問題</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="data-type.html"><a href="data-type.html#vector-"><i class="fa fa-check"></i><b>5.8</b> vector 函數範例</a><ul>
<li class="chapter" data-level="5.8.1" data-path="data-type.html"><a href="data-type.html#cbindrbind"><i class="fa fa-check"></i><b>5.8.1</b> cbind,rbind</a></li>
<li class="chapter" data-level="5.8.2" data-path="data-type.html"><a href="data-type.html#diff"><i class="fa fa-check"></i><b>5.8.2</b> 函數diff</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="data-type.html"><a href="data-type.html#matrix"><i class="fa fa-check"></i><b>5.9</b> matrix</a></li>
<li class="chapter" data-level="5.10" data-path="data-type.html"><a href="data-type.html#section-5.10"><i class="fa fa-check"></i><b>5.10</b> 字串函數</a></li>
<li class="chapter" data-level="5.11" data-path="data-type.html"><a href="data-type.html#regular-expression-syntax"><i class="fa fa-check"></i><b>5.11</b> Regular expression syntax</a><ul>
<li class="chapter" data-level="5.11.1" data-path="data-type.html"><a href="data-type.html#escape-sequences"><i class="fa fa-check"></i><b>5.11.1</b> Escape sequences</a></li>
<li class="chapter" data-level="5.11.2" data-path="data-type.html"><a href="data-type.html#section-5.11.2"><i class="fa fa-check"></i><b>5.11.2</b> 應用</a></li>
<li class="chapter" data-level="5.11.3" data-path="data-type.html"><a href="data-type.html#quantifiers"><i class="fa fa-check"></i><b>5.11.3</b> 數量修飾詞Quantifiers</a></li>
<li class="chapter" data-level="5.11.4" data-path="data-type.html"><a href="data-type.html#position-of-pattern-within-the-string"><i class="fa fa-check"></i><b>5.11.4</b> Position of pattern within the string</a></li>
<li class="chapter" data-level="5.11.5" data-path="data-type.html"><a href="data-type.html#operators"><i class="fa fa-check"></i><b>5.11.5</b> Operators</a></li>
<li class="chapter" data-level="5.11.6" data-path="data-type.html"><a href="data-type.html#character-classes"><i class="fa fa-check"></i><b>5.11.6</b> Character classes</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="data-type.html"><a href="data-type.html#factors"><i class="fa fa-check"></i><b>5.12</b> Factors</a><ul>
<li class="chapter" data-level="5.12.1" data-path="data-type.html"><a href="data-type.html#data-frames"><i class="fa fa-check"></i><b>5.12.1</b> Data Frames</a></li>
<li class="chapter" data-level="5.12.2" data-path="data-type.html"><a href="data-type.html#logical"><i class="fa fa-check"></i><b>5.12.2</b> Logical</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="data-type.html"><a href="data-type.html#tables"><i class="fa fa-check"></i><b>5.13</b> Tables</a><ul>
<li class="chapter" data-level="5.13.1" data-path="data-type.html"><a href="data-type.html#one-way-tables"><i class="fa fa-check"></i><b>5.13.1</b> One Way Tables</a></li>
<li class="chapter" data-level="5.13.2" data-path="data-type.html"><a href="data-type.html#two-way-tables"><i class="fa fa-check"></i><b>5.13.2</b> Two Way Tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="assignment.html"><a href="assignment.html"><i class="fa fa-check"></i><b>6</b> assignment</a><ul>
<li class="chapter" data-level="6.1" data-path="assignment.html"><a href="assignment.html#oop"><i class="fa fa-check"></i><b>6.1</b> OOP</a></li>
<li class="chapter" data-level="6.2" data-path="assignment.html"><a href="assignment.html#operator"><i class="fa fa-check"></i><b>6.2</b> operator %&gt;%</a></li>
<li class="chapter" data-level="6.3" data-path="assignment.html"><a href="assignment.html#attribute"><i class="fa fa-check"></i><b>6.3</b> attribute</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="io.html"><a href="io.html"><i class="fa fa-check"></i><b>7</b> IO</a><ul>
<li class="chapter" data-level="7.1" data-path="io.html"><a href="io.html#csv"><i class="fa fa-check"></i><b>7.1</b> csv</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>8</b> Environments</a><ul>
<li class="chapter" data-level="8.1" data-path="environments.html"><a href="environments.html#introduction-1"><i class="fa fa-check"></i><b>8.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#outline-1"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>8.2</b> Environment basics</a><ul>
<li class="chapter" data-level="8.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>8.2.1</b> Basics</a></li>
<li class="chapter" data-level="8.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>8.2.2</b> Important environments</a></li>
<li class="chapter" data-level="8.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>8.2.3</b> Parents</a></li>
<li class="chapter" data-level="8.2.4" data-path="environments.html"><a href="environments.html#getting-and-setting"><i class="fa fa-check"></i><b>8.2.4</b> Getting and setting</a></li>
<li class="chapter" data-level="8.2.5" data-path="environments.html"><a href="environments.html#finalisers"><i class="fa fa-check"></i><b>8.2.5</b> Finalisers</a></li>
<li class="chapter" data-level="8.2.6" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>8.2.6</b> Advanced bindings</a></li>
<li class="chapter" data-level="8.2.7" data-path="environments.html"><a href="environments.html#exercises-6"><i class="fa fa-check"></i><b>8.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>8.3</b> Recursing over environments</a><ul>
<li class="chapter" data-level="8.3.1" data-path="environments.html"><a href="environments.html#exercises-7"><i class="fa fa-check"></i><b>8.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="environments.html"><a href="environments.html#function-envs"><i class="fa fa-check"></i><b>8.4</b> Special environments</a><ul>
<li class="chapter" data-level="8.4.1" data-path="environments.html"><a href="environments.html#package-environments-and-the-search-path"><i class="fa fa-check"></i><b>8.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="8.4.2" data-path="environments.html"><a href="environments.html#the-function-environment"><i class="fa fa-check"></i><b>8.4.2</b> The function environment</a></li>
<li class="chapter" data-level="8.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>8.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="8.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>8.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="8.4.5" data-path="environments.html"><a href="environments.html#exercises-8"><i class="fa fa-check"></i><b>8.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="environments.html"><a href="environments.html#the-call-stack"><i class="fa fa-check"></i><b>8.5</b> The call stack</a><ul>
<li class="chapter" data-level="8.5.1" data-path="environments.html"><a href="environments.html#simple-call-stacks"><i class="fa fa-check"></i><b>8.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="8.5.2" data-path="environments.html"><a href="environments.html#lazy-evaluation-1"><i class="fa fa-check"></i><b>8.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="8.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>8.5.3</b> Frames</a></li>
<li class="chapter" data-level="8.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>8.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="8.5.5" data-path="environments.html"><a href="environments.html#exercises-9"><i class="fa fa-check"></i><b>8.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>8.6</b> As data structures</a></li>
<li class="chapter" data-level="8.7" data-path="environments.html"><a href="environments.html#section"><i class="fa fa-check"></i><b>8.7</b> <code>&lt;&lt;-</code></a><ul>
<li class="chapter" data-level="8.7.1" data-path="environments.html"><a href="environments.html#exercises-10"><i class="fa fa-check"></i><b>8.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>8.8</b> Quiz answers</a><ul>
<li class="chapter" data-level="8.8.1" data-path="environments.html"><a href="environments.html#term"><i class="fa fa-check"></i><b>8.8.1</b> term</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html"><i class="fa fa-check"></i><b>9</b> Tidy Basic 01</a><ul>
<li class="chapter" data-level="9.1" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#long-and-wide-data"><i class="fa fa-check"></i><b>9.1</b> long and wide data</a><ul>
<li class="chapter" data-level="9.1.1" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#gather-wide-to-long"><i class="fa fa-check"></i><b>9.1.1</b> gather: wide to long</a></li>
<li class="chapter" data-level="9.1.2" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#spread-long-to-wide"><i class="fa fa-check"></i><b>9.1.2</b> spread :long to wide</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#dplyr"><i class="fa fa-check"></i><b>9.2</b> dplyr</a></li>
<li class="chapter" data-level="9.3" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#other"><i class="fa fa-check"></i><b>9.3</b> other</a><ul>
<li class="chapter" data-level="9.3.1" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#basic-verbs"><i class="fa fa-check"></i><b>9.3.1</b> Basic verbs</a></li>
<li class="chapter" data-level="9.3.2" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#group-by"><i class="fa fa-check"></i><b>9.3.2</b> Group by</a></li>
<li class="chapter" data-level="9.3.3" data-path="tidy-basic-01.html"><a href="tidy-basic-01.html#summarize"><i class="fa fa-check"></i><b>9.3.3</b> summarize()</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="basic-plot.html"><a href="basic-plot.html"><i class="fa fa-check"></i><b>10</b> Basic Plot</a><ul>
<li class="chapter" data-level="10.1" data-path="basic-plot.html"><a href="basic-plot.html#reference-1"><i class="fa fa-check"></i><b>10.1</b> reference</a></li>
<li class="chapter" data-level="10.2" data-path="basic-plot.html"><a href="basic-plot.html#basic"><i class="fa fa-check"></i><b>10.2</b> basic</a><ul>
<li class="chapter" data-level="10.2.1" data-path="basic-plot.html"><a href="basic-plot.html#creating-a-graph"><i class="fa fa-check"></i><b>10.2.1</b> Creating a Graph</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="basic-plot.html"><a href="basic-plot.html#histograms-and-density-plots"><i class="fa fa-check"></i><b>10.3</b> Histograms and Density Plots</a><ul>
<li class="chapter" data-level="10.3.1" data-path="basic-plot.html"><a href="basic-plot.html#histograms"><i class="fa fa-check"></i><b>10.3.1</b> Histograms</a></li>
<li class="chapter" data-level="10.3.2" data-path="basic-plot.html"><a href="basic-plot.html#kernel-density-plot"><i class="fa fa-check"></i><b>10.3.2</b> Kernel Density Plot</a></li>
<li class="chapter" data-level="10.3.3" data-path="basic-plot.html"><a href="basic-plot.html#comparing-groups-via-kernal-density"><i class="fa fa-check"></i><b>10.3.3</b> Comparing Groups VIA Kernal Density</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="basic-plot.html"><a href="basic-plot.html#combining-plots"><i class="fa fa-check"></i><b>10.4</b> Combining Plots</a></li>
<li class="chapter" data-level="10.5" data-path="basic-plot.html"><a href="basic-plot.html#add-texts-within-the-graph"><i class="fa fa-check"></i><b>10.5</b> Add texts within the graph</a><ul>
<li class="chapter" data-level="10.5.1" data-path="basic-plot.html"><a href="basic-plot.html#add-text-in-the-margins-of-the-graph"><i class="fa fa-check"></i><b>10.5.1</b> Add text in the margins of the graph</a></li>
<li class="chapter" data-level="10.5.2" data-path="basic-plot.html"><a href="basic-plot.html#add-mathematical-annotation-to-a-plot"><i class="fa fa-check"></i><b>10.5.2</b> Add mathematical annotation to a plot</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="basic-plot.html"><a href="basic-plot.html#section-10.6"><i class="fa fa-check"></i><b>10.6</b> 函數畫圖</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rbook-.html"><a href="rbook-.html"><i class="fa fa-check"></i><b>11</b> rbook 提要</a><ul>
<li class="chapter" data-level="11.1" data-path="rbook-.html"><a href="rbook-.html#index.rmd"><i class="fa fa-check"></i><b>11.1</b> index.Rmd</a></li>
<li class="chapter" data-level="11.2" data-path="rbook-.html"><a href="rbook-.html#_output.yml-"><i class="fa fa-check"></i><b>11.2</b> 其他_output.yml 範例</a></li>
<li class="chapter" data-level="11.3" data-path="rbook-.html"><a href="rbook-.html#travis.yml"><i class="fa fa-check"></i><b>11.3</b> .travis.yml</a></li>
<li class="chapter" data-level="11.4" data-path="rbook-.html"><a href="rbook-.html#section-11.4"><i class="fa fa-check"></i><b>11.4</b> 紀錄</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html"><i class="fa fa-check"></i><b>12</b> gitbook introduction</a><ul>
<li class="chapter" data-level="12.1" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html#output.yml"><i class="fa fa-check"></i><b>12.1</b> _output.yml:</a></li>
<li class="chapter" data-level="12.2" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html#bookdown.yml"><i class="fa fa-check"></i><b>12.2</b> _bookdown.yml:</a></li>
<li class="chapter" data-level="12.3" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html#index.rmd-1"><i class="fa fa-check"></i><b>12.3</b> index.rmd</a></li>
<li class="chapter" data-level="12.4" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html#section-12.4"><i class="fa fa-check"></i><b>12.4</b> 執行</a></li>
<li class="chapter" data-level="12.5" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html#travis"><i class="fa fa-check"></i><b>12.5</b> 加入:Travis</a><ul>
<li class="chapter" data-level="12.5.1" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html#travis.yml-1"><i class="fa fa-check"></i><b>12.5.1</b> .travis.yml:</a></li>
<li class="chapter" data-level="12.5.2" data-path="gitbook-introduction.html"><a href="gitbook-introduction.html#description"><i class="fa fa-check"></i><b>12.5.2</b> DESCRIPTION</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="sample-and-distribution-01.html"><a href="sample-and-distribution-01.html"><i class="fa fa-check"></i><b>13</b> Sample and Distribution 01</a><ul>
<li class="chapter" data-level="13.1" data-path="sample-and-distribution-01.html"><a href="sample-and-distribution-01.html#section-13.1"><i class="fa fa-check"></i><b>13.1</b> 排列組合與概率的計算</a></li>
<li class="chapter" data-level="13.2" data-path="sample-and-distribution-01.html"><a href="sample-and-distribution-01.html#distribution"><i class="fa fa-check"></i><b>13.2</b> distribution</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">test for class</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Functions</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">3.1</span> Introduction</h2>
<p>簡單測試
### Quiz {-}</p>
<p>Answer the following questions to see if you can safely skip this chapter. You can find the answers in <a href="#function-answer"><strong>??</strong></a>.</p>
<ol style="list-style-type: decimal">
<li><p>What are the three components of a function?</p></li>
<li><p>What does the following code return?</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">    x <span class="op">+</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="kw">f1</span>(<span class="dv">1</span>)()</a></code></pre></div></li>
<li><p>How would you usually write this code?</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="st">`</span><span class="dt">+</span><span class="st">`</span>(<span class="dv">1</span>, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>(<span class="dv">2</span>, <span class="dv">3</span>))</a></code></pre></div></li>
<li><p>How could you make this call easier to read?</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">mean</span>(, <span class="ot">TRUE</span>, <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">NA</span>))</a></code></pre></div></li>
<li><p>Does the following code throw an error when executed? Why/why not?</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">f2 &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) {</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  a <span class="op">*</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">f2</span>(<span class="dv">10</span>, <span class="kw">stop</span>(<span class="st">&quot;This is an error!&quot;</span>))</a></code></pre></div></li>
<li><p>What is an infix function? How do you write it? What’s a replacement
function? How do you write it?</p></li>
<li><p>How do you ensure that cleanup action occurs regardless of how a function
exits?</p></li>
</ol>
<div id="outline" class="section level3 unnumbered">
<h3>Outline</h3>
<ul>
<li><p>Section <a href="functions.html#function-fundamentals">3.2</a> describes the basics of creating a
function, the three main components of a function, and the exception
to many function rules: primitive functions (which are implemented in C, not
R).</p></li>
<li><p>Section <a href="functions.html#lexical-scoping">3.3</a> shows you how R finds the value associated
with a given name, i.e. the rules of lexical scoping.</p></li>
<li><p>Section <a href="functions.html#lazy-evaluation">3.4</a> is devoted to an important property of
function arguments: they are only evaluated when used for the first time.</p></li>
<li><p>Section <a href="functions.html#exiting-a-function">3.6</a> discusses the two primary ways that a
function can exit, and how to define an exit handler, code that is run on
exit, regardless of what triggers it.</p></li>
<li><p>Section <a href="functions.html#function-forms">3.7</a> shows you the various ways in which R
disguises ordinary function calls, and how you can use the standard prefix
form to better understand what’s going on.</p></li>
</ul>
</div>
</div>
<div id="function-fundamentals" class="section level2">
<h2><span class="header-section-number">3.2</span> Function fundamentals</h2>
<p>幾個重要觀念</p>
<ul>
<li><p>函數也是物件,就像是vectors 也是物件。</p></li>
<li><p>由三個部份組成: arguments, body, and environment.</p></li>
</ul>
<p>There are exceptions to every rule, and in this case, there is a small selection of “primitive” base functions that are implemented purely in C.</p>
<div id="first-class-functions" class="section level3">
<h3><span class="header-section-number">3.2.1</span> First-class functions</h3>
<p>在R中,函數也是物件,這種特性也叫做 “first-class functions”. 如下:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">f01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  <span class="kw">sin</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>x <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">}</a></code></pre></div>
<p><img src="diagrams/functions/first-class.png" style="display: block; margin: auto;" /></p>
<p>匿名函數:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">lapply</span>(mtcars, <span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw">Filter</span>(<span class="cf">function</span>(x) <span class="op">!</span><span class="kw">is.numeric</span>(x), mtcars)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">integrate</span>(<span class="cf">function</span>(x) <span class="kw">sin</span>(x) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">0</span>, pi)</a></code></pre></div>
<p>在list中,也可以放入:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">funs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  <span class="dt">half =</span> <span class="cf">function</span>(x) x <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="dt">double =</span> <span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">funs<span class="op">$</span><span class="kw">double</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt; [1] 20</span></a></code></pre></div>
<p>在R語言中,函數有叫做closure因為,R函數包含(enclose)它們的環境 environments.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">typeof</span>(f01)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; [1] &quot;closure&quot;</span></a></code></pre></div>
</div>
<div id="function-components" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Function components</h3>
<p>1個函數有3個部分:</p>
<ul>
<li><p><code>formals()</code>, 參數</p></li>
<li><p><code>body()</code>, {}內部.</p></li>
<li><p><code>environment()</code>, 決定函數怎樣找出變數(names)的內容。.</p></li>
</ul>
<p>I’ll draw functions as in the following diagram. The black dot on the left is the environment. The two blocks to the right are the function arguments. I won’t draw the body, because it’s usually large, and doesn’t help you understand the “shape” of the function.</p>
<p><img src="diagrams/functions/components.png" style="display: block; margin: auto;" /></p>
<p>The function environment always exists, but it is only printed when the function isn’t defined in the global environment.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">f02 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">  <span class="co"># A comment</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  x <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="kw">formals</span>(f02)</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; $x</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="kw">body</span>(f02)</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt;     x^2</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="kw">environment</span>(f02)</a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; &lt;environment: R_GlobalEnv&gt;</span></a></code></pre></div>
<p>就像所以其他R的物件,函數也有很多 <code>attributes()</code>. 其中一個 “srcref”, 是 source reference的縮寫。 　</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">attr</span>(f02, <span class="st">&quot;srcref&quot;</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">#&gt; function(x) {</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt;   # A comment</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt;   x ^ 2</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; }</span></a></code></pre></div>
</div>
<div id="primitive-functions" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Primitive functions</h3>
<p>３個組件的規則有例外，像是 Primitive functions, like <code>sum()</code> and <code>[</code>, 直接調用Ｃ語言。</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">sum</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co">#&gt; function (..., na.rm = FALSE)  .Primitive(&quot;sum&quot;)</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">`</span><span class="dt">[</span><span class="st">`</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt; .Primitive(&quot;[&quot;)</span></a></code></pre></div>
<p>看一下type
分別屬於 “builtin” or “special”:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">typeof</span>(sum)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co">#&gt; [1] &quot;builtin&quot;</span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw">typeof</span>(<span class="st">`</span><span class="dt">[</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="co">#&gt; [1] &quot;special&quot;</span></a></code></pre></div>
<p>因此， <code>formals()</code>, <code>body()</code>, and <code>environment()</code> 都回傳 <code>NULL</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">formals</span>(sum)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="kw">body</span>(sum)</a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="kw">environment</span>(sum)</a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt; NULL</span></a></code></pre></div>
<p>這些所謂的原始函數，只存在於基本套件(base packages) 。.</p>
</div>
<div id="exercises" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Given a function, like <code>&quot;mean&quot;</code>, <code>match.fun()</code> lets you find a function.
Given a function, can you find its name? Why doesn’t that make sense in R?</p></li>
<li><p>It’s possible (although typically not useful) to call an anonymous function.
Which of the two approaches below is correct? Why?</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="cf">function</span>(x) <span class="dv">3</span>()</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="co">#&gt; function(x) 3()</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3">(<span class="cf">function</span>(x) <span class="dv">3</span>)()</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">#&gt; [1] 3</span></a></code></pre></div></li>
<li><p>A good rule of thumb is that an anonymous function should fit on one line
and shouldn’t need to use <code>{}</code>. Review your code. Where could you have
used an anonymous function instead of a named function? Where should you
have used a named function instead of an anonymous function?</p></li>
<li><p>What function allows you to tell if an object is a function? What function
allows you to tell if a function is a primitive function?</p></li>
<li><p>This code makes a list of all functions in the base package.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">objs &lt;-<span class="st"> </span><span class="kw">mget</span>(<span class="kw">ls</span>(<span class="st">&quot;package:base&quot;</span>), <span class="dt">inherits =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">funs &lt;-<span class="st"> </span><span class="kw">Filter</span>(is.function, objs)</a></code></pre></div>
<p>Use it to answer the following questions:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Which base function has the most arguments?</p></li>
<li><p>How many base functions have no arguments? What’s special about those
functions?</p></li>
<li><p>How could you adapt the code to find all primitive functions?</p></li>
</ol></li>
<li><p>What are the three important components of a function?</p></li>
<li><p>When does printing a function not show the environment it was created in?</p></li>
</ol>
</div>
</div>
<div id="lexical-scoping" class="section level2">
<h2><span class="header-section-number">3.3</span> Lexical scoping</h2>
<p>In [Names and values], we discussed assignment, the act of binding a name to a value. Here we’ll discuss <strong>scoping</strong>, the act of finding the value associated with a name.</p>
<p>下面的執行結果傳回10還是20?<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">g01 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb25-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">  x</a>
<a class="sourceLine" id="cb25-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb25-6" data-line-number="6"></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="kw">g01</span>()</a></code></pre></div>
<p>了解範圍規則,有助於函數的模組開發,甚至有助於將R翻譯到其他語言。</p>
<p><em>lexical scoping</em>　<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>: it looks up the values of names based on how a function is defined, not how it is called. “Lexical” here is not the English adjective “relating to words or a vocabulary”. It’s a technical CS term that tells us that the scoping rules use a parse-time, rather than a run-time structure.</p>
<p>R的’s lexical scoping 遵循4個主要規則::</p>
<ul>
<li>Name masking</li>
<li>Functions vs. variables</li>
<li>A fresh start</li>
<li>Dynamic lookup</li>
</ul>
<div id="name-masking" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Name masking</h3>
<p>內部範圍的宣告(第一次使用)覆蓋外部範圍的宣告。.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3">g02 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">  x &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">  y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6">  <span class="kw">c</span>(x, y)</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="kw">g02</span>()</a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="co">#&gt; [1] 1 2</span></a></code></pre></div>
<p>如果在內部宣告找不到,就找外一層，一直到global environment。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">g03 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">  y &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb27-4" data-line-number="4">  <span class="kw">c</span>(x, y)</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="kw">g03</span>()</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt; [1] 2 1</span></a></code></pre></div>
<p>上面的規則仍然適用於函數中的函數.</p>
<p>測試:下面的R程式會有甚麼結果 ? <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">g04 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">  y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4">  i &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb28-5" data-line-number="5">    z &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">    <span class="kw">c</span>(x, y, z)</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  <span class="kw">i</span>()</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="kw">g04</span>()</a></code></pre></div>
<p>同樣也適用於建立函數的函數( <strong>closures</strong>).參考 [closures]; 這裡只是用來說明上述規則的使用。 <code>g05()</code>, 傳回函數,猜猜執行結果?<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">g05 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">  y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">    <span class="kw">c</span>(x, y)</a>
<a class="sourceLine" id="cb29-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb29-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">g06 &lt;-<span class="st"> </span><span class="kw">g05</span>()</a>
<a class="sourceLine" id="cb29-11" data-line-number="11"><span class="kw">g06</span>()</a></code></pre></div>
<p>This seems a little magical: how does R know what the value of <code>y</code> is after <code>j()</code> has returned? It works because <code>k</code> preserves the environment in which it was defined and because the environment includes the value of <code>y</code>. You’ll learn more about how environments work in <a href="environments.html#environments">Environments</a>.</p>
</div>
<div id="functions-vs.variables" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Functions vs. variables</h3>
<p>既然函數也只是普通的物件,那麼同樣的名稱尋找規則也適用於函數:這個例子中,g07在外部和內部皆有定義。</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">g07 &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">g08 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">  g07 &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4">  <span class="kw">g07</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb30-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="kw">g08</span>()</a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co">#&gt; [1] 110</span></a></code></pre></div>
<p>但是如果同一個名稱,在不同範圍有不一樣的型態呢?例如g9一個是變數,一個是函數:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">g09 &lt;-<span class="st"> </span><span class="cf">function</span>(x) x <span class="op">+</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2">g10 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb31-3" data-line-number="3">  g09 &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4">  <span class="kw">g09</span>(g09)</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="kw">g10</span>()</a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="co">#&gt; [1] 110</span></a></code></pre></div>
<p>一般來講,上面的用法在語法上是沒問題,但是最好避免。</p>
</div>
<div id="fresh-start" class="section level3">
<h3><span class="header-section-number">3.3.3</span> A fresh start</h3>
<p>第一次執行和第二次執行有甚麼不同?<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p>函數 <code>exists(x)</code> :會尋找變數名稱x是否存在,存在則無回 <code>TRUE</code>,否則傳回 <code>FALSE</code>.)</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">g11 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">exists</span>(<span class="st">&quot;a&quot;</span>)) {</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">    a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">    a &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">  a</a>
<a class="sourceLine" id="cb32-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb32-10" data-line-number="10"></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="kw">g11</span>()</a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="kw">g11</span>()</a></code></pre></div>
<p>每次執行的時候,一個新的environment會被建立,用來主導函數的執行。 <a href="#stateful-funs"><strong>??</strong></a>.)</p>
</div>
<div id="dynamic-lookup" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Dynamic lookup</h3>
<p>Lexical scoping determines where to look for values, not when to look for them. R looks for values when the function is run, not when it’s created. This means that the output of a function can differ depending on objects outside its environment:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">g12 &lt;-<span class="st"> </span><span class="cf">function</span>() x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="kw">g12</span>()</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="co">#&gt; [1] 16</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"></a>
<a class="sourceLine" id="cb33-6" data-line-number="6">x &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="kw">g12</span>()</a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">#&gt; [1] 21</span></a></code></pre></div>
<p>This behaviour can be quite annoying. If you make a spelling mistake in your code, you won’t get an error when you create the function, and you might not even get one when you run the function, depending on what variables are defined in the global environment.</p>
<p>One way to detect this problem is to use <code>codetools::findGlobals()</code>. This function lists all the external dependencies (unbound symbols) within a function:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">codetools<span class="op">::</span><span class="kw">findGlobals</span>(g12)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="co">#&gt; [1] &quot;+&quot; &quot;x&quot;</span></a></code></pre></div>
<p>Another way to solve the problem would be to manually change the environment of the function to the <code>emptyenv()</code>, an environment which contains nothing:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">environment</span>(g12) &lt;-<span class="st"> </span><span class="kw">emptyenv</span>()</a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="kw">g12</span>()</a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="co">#&gt; Error in x + 1:</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="co">#&gt;   could not find function &quot;+&quot;</span></a></code></pre></div>
<p>Both of these approaches reveal why this undesirable behaviour exists: R relies on lexical scoping to find <em>everything</em>, even the <code>+</code> operator. This provides a rather beautiful simplicity to R’s scoping rules.</p>
</div>
<div id="exercises-1" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What does the following code return? Why? Describe how each of the three
<code>c</code>’s is interpreted.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">c &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="kw">c</span>(<span class="dt">c =</span> c)</a></code></pre></div></li>
<li><p>What are the four principles that govern how R looks for values?</p></li>
<li><p>What does the following function return? Make a prediction before
running the code yourself.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb37-2" data-line-number="2">  f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">    f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">      x <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb37-5" data-line-number="5">    }</a>
<a class="sourceLine" id="cb37-6" data-line-number="6">    <span class="kw">f</span>() <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb37-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb37-8" data-line-number="8">  <span class="kw">f</span>(x) <span class="op">*</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb37-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb37-10" data-line-number="10"><span class="kw">f</span>(<span class="dv">10</span>)</a></code></pre></div></li>
</ol>
</div>
</div>
<div id="lazy-evaluation" class="section level2">
<h2><span class="header-section-number">3.4</span> Lazy evaluation</h2>
<p>In R, function arguments are <strong>lazily evaluated</strong>: they’re only evaluated if accessed. For example, this code doesn’t generate an error because <code>x</code> is never used:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">h01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">  <span class="dv">10</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="kw">h01</span>(<span class="kw">stop</span>(<span class="st">&quot;This is an error!&quot;</span>))</a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="co">#&gt; [1] 10</span></a></code></pre></div>
<p>This is an important feature because it allows you to do things like include potentially expensive computations in function arguments that will only be evaluated if needed.</p>
<div id="forcing-evaluation" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Forcing evaluation</h3>
<p>To <strong>compel</strong> the evaluation of an argument, use <code>force()</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">h02 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb39-2" data-line-number="2">  <span class="kw">force</span>(x)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">  <span class="dv">10</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="kw">h02</span>(<span class="kw">stop</span>(<span class="st">&quot;This is an error!&quot;</span>))</a>
<a class="sourceLine" id="cb39-6" data-line-number="6"><span class="co">#&gt; Error in force(x):</span></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="co">#&gt;   This is an error!</span></a></code></pre></div>
<p>It is usually not necessary to force evaluation. It’s needed primarily for certain functional programming techniques which we’ll cover in detail in [function operators]. Here, I want to show you the basic issue.</p>
<p>Take this small but surprisingly tricky function. It takes a single argument <code>x</code>, and returns a function that returns <code>x</code> when called.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">capture1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    x</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">}</a></code></pre></div>
<p>There’s a subtle issue with this function: the value of <code>x</code> will be captured not when you call <code>capture()</code>, but when you call the function that <code>capture()</code> returns:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2">h03 &lt;-<span class="st"> </span><span class="kw">capture1</span>(x)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">h04 &lt;-<span class="st"> </span><span class="kw">capture1</span>(x)</a>
<a class="sourceLine" id="cb41-4" data-line-number="4"></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="kw">h03</span>()</a>
<a class="sourceLine" id="cb41-6" data-line-number="6"><span class="co">#&gt; [1] 10</span></a>
<a class="sourceLine" id="cb41-7" data-line-number="7"></a>
<a class="sourceLine" id="cb41-8" data-line-number="8">x &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb41-9" data-line-number="9"><span class="kw">h04</span>()</a>
<a class="sourceLine" id="cb41-10" data-line-number="10"><span class="co">#&gt; [1] 20</span></a></code></pre></div>
<p>Even more confusingly this only happens once: the value is locked in after you have called <code>h03()</code>/<code>h04()</code> for the first time.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="kw">h03</span>()</a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="co">#&gt; [1] 10</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="kw">h04</span>()</a>
<a class="sourceLine" id="cb42-5" data-line-number="5"><span class="co">#&gt; [1] 20</span></a></code></pre></div>
<p>This behaviour is a consequence of lazy evaluation. The <code>x</code> argument is evaluated once <code>h03()</code>/<code>h04()</code> is called, and then its value is cached. We can avoid the confusion by forcing <code>x</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">capture2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb43-2" data-line-number="2">  <span class="kw">force</span>(x)</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb43-4" data-line-number="4">  <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb43-5" data-line-number="5">    x</a>
<a class="sourceLine" id="cb43-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb43-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb43-8" data-line-number="8"></a>
<a class="sourceLine" id="cb43-9" data-line-number="9">x &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb43-10" data-line-number="10">h05 &lt;-<span class="st"> </span><span class="kw">capture2</span>(x)</a>
<a class="sourceLine" id="cb43-11" data-line-number="11"></a>
<a class="sourceLine" id="cb43-12" data-line-number="12">x &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb43-13" data-line-number="13"><span class="kw">h05</span>()</a>
<a class="sourceLine" id="cb43-14" data-line-number="14"><span class="co">#&gt; [1] 10</span></a></code></pre></div>
</div>
<div id="promises" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Promises</h3>
<p>}</p>
<p>Lazy evaluation is powered by a data structure called a <strong>promise</strong>, or (less commonly) a thunk. We’ll come back to this data structure in <a href="#meta">metaprogramming</a> because it’s one of the features of R that makes it most interesting as a programming language.</p>
<p>A promise has three components:</p>
<ul>
<li><p>The expression, like <code>x + y</code> which gives rise to the delayed computation.</p></li>
<li><p>The environment where the expression should be evaluated.</p></li>
<li><p>The value, which is computed and cached when the promise is first accessed
by evaluating the expression in the specified environment.</p></li>
</ul>
<p>The value cache ensures that accessing the promise multiple times always returns the same value. For example, you can see in the following code that <code>runif(1)</code> is only evaluated once:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">h06 &lt;-<span class="st"> </span><span class="cf">function</span>(x) { </a>
<a class="sourceLine" id="cb44-2" data-line-number="2">  <span class="kw">c</span>(x, x, x)  </a>
<a class="sourceLine" id="cb44-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb44-4" data-line-number="4"></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="kw">h06</span>(<span class="kw">runif</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb44-6" data-line-number="6"><span class="co">#&gt; [1] 0.0808 0.0808 0.0808</span></a></code></pre></div>
<p>You can also create promises “by hand” using <code>delayedAssign()</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">delayedAssign</span>(<span class="st">&quot;x&quot;</span>, {<span class="kw">print</span>(<span class="st">&quot;Executing code&quot;</span>); <span class="kw">runif</span>(<span class="dv">1</span>)})</a>
<a class="sourceLine" id="cb45-2" data-line-number="2">x</a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="co">#&gt; [1] &quot;Executing code&quot;</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="co">#&gt; [1] 0.834</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5">x</a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="co">#&gt; [1] 0.834</span></a></code></pre></div>
<p>You’ll see this idea again in <a href="environments.html#advanced-bindings">advanced bindings</a>.</p>
</div>
<div id="default-arguments" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Default arguments</h3>
<p>Thanks to lazy evaluation, default value can be defined in terms of other arguments, or even in terms of variables defined later in the function:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">h07 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">z =</span> a <span class="op">+</span><span class="st"> </span>b) {</a>
<a class="sourceLine" id="cb46-2" data-line-number="2">  a &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3">  b &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb46-5" data-line-number="5">  <span class="kw">c</span>(x, y, z)</a>
<a class="sourceLine" id="cb46-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb46-7" data-line-number="7"></a>
<a class="sourceLine" id="cb46-8" data-line-number="8"><span class="kw">h07</span>()</a>
<a class="sourceLine" id="cb46-9" data-line-number="9"><span class="co">#&gt; [1]   1   2 110</span></a></code></pre></div>
<p>Many base R functions use this technique, but I don’t recommend it. It makes code harder to understand because it requires that you know exactly <em>when</em> default arguments are evaluated in order to predict <em>what</em> they will evaluate to.</p>
<p>The evaluation environment is slightly different for default and user supplied arguments, as default arguments are evaluated inside the function. This means that seemingly identical calls can yield different results. It’s easiest to see this with an extreme example:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">h08 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="kw">ls</span>()) {</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">  a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3">  x</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb47-5" data-line-number="5"></a>
<a class="sourceLine" id="cb47-6" data-line-number="6"><span class="co"># ls() evaluated inside f:</span></a>
<a class="sourceLine" id="cb47-7" data-line-number="7"><span class="kw">h08</span>()</a>
<a class="sourceLine" id="cb47-8" data-line-number="8"><span class="co">#&gt; [1] &quot;a&quot; &quot;x&quot;</span></a>
<a class="sourceLine" id="cb47-9" data-line-number="9"></a>
<a class="sourceLine" id="cb47-10" data-line-number="10"><span class="co"># ls() evaluated in global environment:</span></a>
<a class="sourceLine" id="cb47-11" data-line-number="11"><span class="kw">h08</span>(<span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb47-12" data-line-number="12"><span class="co">#&gt; [1] &quot;f&quot;</span></a></code></pre></div>
</div>
<div id="missing-arguments" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Missing arguments</h3>
<p>If an argument has a default, you can determine if the value comes from the user or the default with <code>missing()</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">h09 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb48-2" data-line-number="2">  <span class="kw">list</span>(<span class="kw">missing</span>(x), x)</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="kw">str</span>(<span class="kw">h09</span>())</a>
<a class="sourceLine" id="cb48-5" data-line-number="5"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb48-6" data-line-number="6"><span class="co">#&gt;  $ : logi TRUE</span></a>
<a class="sourceLine" id="cb48-7" data-line-number="7"><span class="co">#&gt;  $ : num 10</span></a>
<a class="sourceLine" id="cb48-8" data-line-number="8"><span class="kw">str</span>(<span class="kw">h09</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb48-9" data-line-number="9"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb48-10" data-line-number="10"><span class="co">#&gt;  $ : logi FALSE</span></a>
<a class="sourceLine" id="cb48-11" data-line-number="11"><span class="co">#&gt;  $ : num 10</span></a></code></pre></div>
<p><code>missing()</code> is best used sparingly. Take <code>sample()</code>, for example. How many arguments are required?</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">args</span>(sample)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="co">#&gt; function (x, size, replace = FALSE, prob = NULL) </span></a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="co">#&gt; NULL</span></a></code></pre></div>
<p>It looks like both <code>x</code> and <code>size</code> are required, but in fact <code>sample()</code> uses <code>missing()</code> to provide a default for <code>size</code> if it’s not supplied. If I was to rewrite sample myself<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>, I’d use an explicit <code>NULL</code> to indicate that <code>size</code> can be supplied, but it’s not required:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">sample &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">size =</span> <span class="ot">NULL</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>, <span class="dt">prob =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">is.null</span>(size)) {</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">    size &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb50-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb50-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb50-6" data-line-number="6">  x[<span class="kw">sample.int</span>(<span class="kw">length</span>(x), size, <span class="dt">replace =</span> replace, <span class="dt">prob =</span> prob)]</a>
<a class="sourceLine" id="cb50-7" data-line-number="7">}</a></code></pre></div>
<p>You can make that pattern even simpler with a small helper. The infix <code>%||%</code> function uses the LHS if it’s not null, otherwise it uses the RHS:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="st">`</span><span class="dt">%||%</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(lhs, rhs) {</a>
<a class="sourceLine" id="cb51-2" data-line-number="2">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(lhs)) {</a>
<a class="sourceLine" id="cb51-3" data-line-number="3">    lhs</a>
<a class="sourceLine" id="cb51-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb51-5" data-line-number="5">    rhs</a>
<a class="sourceLine" id="cb51-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb51-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb51-8" data-line-number="8"></a>
<a class="sourceLine" id="cb51-9" data-line-number="9">sample &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">size =</span> <span class="ot">NULL</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>, <span class="dt">prob =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb51-10" data-line-number="10">  size &lt;-<span class="st"> </span>size <span class="op">%||%</span><span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb51-11" data-line-number="11">  x[<span class="kw">sample.int</span>(<span class="kw">length</span>(x), size, <span class="dt">replace =</span> replace, <span class="dt">prob =</span> prob)]</a>
<a class="sourceLine" id="cb51-12" data-line-number="12">}</a></code></pre></div>
<p>Because of lazy evaluation, you don’t need to worry about unnecessary computation: the RHS of <code>%||%</code> will only be evaluated if the LHS is null.</p>
</div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What important property of <code>&amp;&amp;</code> make <code>x_ok()</code> work?</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">x_ok &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb52-2" data-line-number="2">  <span class="op">!</span><span class="kw">is.null</span>(x) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;&amp;</span><span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb52-4" data-line-number="4"></a>
<a class="sourceLine" id="cb52-5" data-line-number="5"><span class="kw">x_ok</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb52-6" data-line-number="6"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb52-7" data-line-number="7"><span class="kw">x_ok</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb52-8" data-line-number="8"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9"><span class="kw">x_ok</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb52-10" data-line-number="10"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>What is different with this code? Why is this behaviour undesirable here?</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">x_ok &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb53-2" data-line-number="2">  <span class="op">!</span><span class="kw">is.null</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb53-4" data-line-number="4"></a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="kw">x_ok</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb53-6" data-line-number="6"><span class="co">#&gt; logical(0)</span></a>
<a class="sourceLine" id="cb53-7" data-line-number="7"><span class="kw">x_ok</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb53-8" data-line-number="8"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb53-9" data-line-number="9"><span class="kw">x_ok</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb53-10" data-line-number="10"><span class="co">#&gt; [1] FALSE FALSE FALSE</span></a></code></pre></div></li>
<li><p>The definition of <code>force()</code> is simple:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">force</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="co">#&gt; function (x) </span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="co">#&gt; x</span></a>
<a class="sourceLine" id="cb54-4" data-line-number="4"><span class="co">#&gt; &lt;bytecode: 0x0000000015fe1750&gt;</span></a>
<a class="sourceLine" id="cb54-5" data-line-number="5"><span class="co">#&gt; &lt;environment: namespace:base&gt;</span></a></code></pre></div>
<p>Why is it better to <code>force(x)</code> instead of just <code>x</code>?</p></li>
<li><p>What does this function return? Why? Which principle does it illustrate?</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">f2 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> z) {</a>
<a class="sourceLine" id="cb55-2" data-line-number="2">  z &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3">  x</a>
<a class="sourceLine" id="cb55-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb55-5" data-line-number="5"><span class="kw">f2</span>()</a></code></pre></div></li>
<li><p>What does this function return? Why? Which principle does it illustrate?</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> {y &lt;-<span class="st"> </span><span class="dv">1</span>; <span class="dv">2</span>}, <span class="dt">y =</span> <span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb56-3" data-line-number="3">  <span class="kw">c</span>(x, y)</a>
<a class="sourceLine" id="cb56-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb56-5" data-line-number="5"><span class="kw">f1</span>()</a>
<a class="sourceLine" id="cb56-6" data-line-number="6">y</a></code></pre></div></li>
<li><p>In <code>hist()</code>, the default value of <code>xlim</code> is <code>range(breaks)</code>, the default
value for <code>breaks</code> is <code>&quot;Sturges&quot;</code>, and</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">range</span>(<span class="st">&quot;Sturges&quot;</span>)</a>
<a class="sourceLine" id="cb57-2" data-line-number="2"><span class="co">#&gt; [1] &quot;Sturges&quot; &quot;Sturges&quot;</span></a></code></pre></div>
<p>Explain how <code>hist()</code> works to get a correct <code>xlim</code> value.</p></li>
<li><p>Explain why this function works. Why is it confusing?</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">show_time &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="kw">stop</span>(<span class="st">&quot;Error!&quot;</span>)) {</a>
<a class="sourceLine" id="cb58-2" data-line-number="2">  stop &lt;-<span class="st"> </span><span class="cf">function</span>(...) <span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb58-3" data-line-number="3">  <span class="kw">print</span>(x)</a>
<a class="sourceLine" id="cb58-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb58-5" data-line-number="5"><span class="kw">show_time</span>()</a>
<a class="sourceLine" id="cb58-6" data-line-number="6"><span class="co">#&gt; [1] &quot;2018-10-28 02:19:48 CST&quot;</span></a></code></pre></div></li>
<li><p>How many arguments are required when calling <code>library()</code>?</p></li>
</ol>
</div>
</div>
<div id="fun-dot-dot-dot" class="section level2">
<h2><span class="header-section-number">3.5</span> <code>...</code> (dot-dot-dot)</h2>
<p>Functions can have a special argument <code>...</code> (pronounced dot-dot-dot). If a function has this argument, it can take any number of additional arguments. In other programming languages, this type of argument is often called a varargs, or the function is said to be variadic.</p>
<p>Inside a function, you can use <code>...</code> to pass those additional arguments on to another function:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">i01 &lt;-<span class="st"> </span><span class="cf">function</span>(y, z) {</a>
<a class="sourceLine" id="cb59-2" data-line-number="2">  <span class="kw">list</span>(<span class="dt">y =</span> y, <span class="dt">z =</span> z)</a>
<a class="sourceLine" id="cb59-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb59-4" data-line-number="4"></a>
<a class="sourceLine" id="cb59-5" data-line-number="5">i02 &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {</a>
<a class="sourceLine" id="cb59-6" data-line-number="6">  <span class="kw">i01</span>(...)</a>
<a class="sourceLine" id="cb59-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb59-8" data-line-number="8"></a>
<a class="sourceLine" id="cb59-9" data-line-number="9"><span class="kw">str</span>(<span class="kw">i02</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>, <span class="dt">z =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb59-10" data-line-number="10"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb59-11" data-line-number="11"><span class="co">#&gt;  $ y: num 2</span></a>
<a class="sourceLine" id="cb59-12" data-line-number="12"><span class="co">#&gt;  $ z: num 3</span></a></code></pre></div>
<p>It’s possible (but rarely useful) to refer to elements of <code>...</code> by their position, using a special form:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">i03 &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb60-2" data-line-number="2">  <span class="kw">list</span>(<span class="dt">first =</span> ..<span class="dv">1</span>, <span class="dt">third =</span> ..<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb60-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="kw">str</span>(<span class="kw">i03</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb60-5" data-line-number="5"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb60-6" data-line-number="6"><span class="co">#&gt;  $ first: num 1</span></a>
<a class="sourceLine" id="cb60-7" data-line-number="7"><span class="co">#&gt;  $ third: num 3</span></a></code></pre></div>
<p>More often useful is <code>list(...)</code>, which evaluates the arguments and stores them in a list:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">i04 &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">  <span class="kw">list</span>(...)</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb61-4" data-line-number="4"><span class="kw">str</span>(<span class="kw">i04</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb61-5" data-line-number="5"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6"><span class="co">#&gt;  $ a: num 1</span></a>
<a class="sourceLine" id="cb61-7" data-line-number="7"><span class="co">#&gt;  $ b: num 2</span></a></code></pre></div>
<p>(See also <code>rlang::list2()</code> to support splicing and to silently ignore trailing commas, and <code>rlang::enquos()</code> to capture the unevaluated arguments, the topic of [quasiquotation].)</p>
<p>There are two primary uses of <code>...</code>, both of which we’ll come back to later in the book:</p>
<ul>
<li><p>If your function takes a function as an argument, you want some way to
pass on additional arguments to that function. In this example, <code>lapply()</code>
uses <code>...</code> to pass <code>na.rm</code> on to <code>mean()</code>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="ot">NA</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="ot">NA</span>, <span class="dv">6</span>))</a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="kw">str</span>(<span class="kw">lapply</span>(x, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb62-4" data-line-number="4"><span class="co">#&gt;  $ : num 2</span></a>
<a class="sourceLine" id="cb62-5" data-line-number="5"><span class="co">#&gt;  $ : num 5</span></a></code></pre></div>
<p>We’ll come back to this technique in Section <a href="#functional-arguments"><strong>??</strong></a>.</p></li>
<li><p>If your function is an S3 generic, you need some way to allow methods to
take arbitrary extra arguments. For example, take the <code>print()</code> function.
There are different options for printing types of object, so there’s no
way for the print generic to prespecify every possible argument. Instead,
it uses <code>...</code> to allow individual methods to have different arguments:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">factor</span>(letters), <span class="dt">max.levels =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb63-2" data-line-number="2"></a>
<a class="sourceLine" id="cb63-3" data-line-number="3"><span class="kw">print</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">showEnv =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>We’ll come back to this use of <code>...</code> in Section <a href="#s3-arguments"><strong>??</strong></a>.</p></li>
</ul>
<p>Using <code>...</code> comes with two downsides:</p>
<ul>
<li><p>When you use it to pass arguments on to another function, you have to
carefully explain to the user where those arguments go. This makes it
hard to understand the what you can do with functions like <code>lapply()</code> and
<code>plot()</code>.</p></li>
<li><p>Any misspelled arguments will not raise an error. This makes it easy for
typos to go unnoticed:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dt">na_rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="co">#&gt; [1] NA</span></a></code></pre></div></li>
</ul>
<p><code>...</code> is a powerful tool, but be aware of the downsides.</p>
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Explain the following results:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="co">#&gt; [1] 6</span></a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="kw">mean</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb65-4" data-line-number="4"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb65-5" data-line-number="5"></a>
<a class="sourceLine" id="cb65-6" data-line-number="6"><span class="kw">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">na.omit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb65-7" data-line-number="7"><span class="co">#&gt; [1] 7</span></a>
<a class="sourceLine" id="cb65-8" data-line-number="8"><span class="kw">mean</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">na.omit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb65-9" data-line-number="9"><span class="co">#&gt; [1] 1</span></a></code></pre></div></li>
<li><p>In the following call, explain how to find the documentation for the
named arguments in the following function call:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">plot</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="dt">col.lab =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p><img src="rmi_copy_test_files/figure-html/unnamed-chunk-73-1.png" width="70%" style="display: block; margin: auto;" /></p></li>
<li><p>Why does <code>plot(1:10, col = &quot;red&quot;)</code> only colour the points, not the axes
or labels? Read the source code of <code>plot.default()</code> to find out.</p></li>
</ol>
</div>
</div>
<div id="exiting-a-function" class="section level2">
<h2><span class="header-section-number">3.6</span> Exiting a function</h2>
<p>Most functions exit in one of two ways<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>: either returning a value, indicating successful completion, or throwing an error, indicating failure. This section describes return values (implicit vs. explicit; visible vs. invisible), briefly discusses errors, and introduces exit handlers, which allow you to run code when a function exits, regardless of how it exits.</p>
<div id="implicit-vs.explict-returns" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Implicit vs. explict returns</h3>
<p>There are two ways that a function can return a value:</p>
<ul>
<li><p>Implicitly, where the last evaluated expression becomes the return
value:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">j01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">  <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">    <span class="dv">0</span></a>
<a class="sourceLine" id="cb67-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb67-5" data-line-number="5">    <span class="dv">10</span></a>
<a class="sourceLine" id="cb67-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb67-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb67-8" data-line-number="8"><span class="kw">f</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb67-9" data-line-number="9"><span class="co">#&gt; [1] 52</span></a>
<a class="sourceLine" id="cb67-10" data-line-number="10"><span class="kw">f</span>(<span class="dv">15</span>)</a>
<a class="sourceLine" id="cb67-11" data-line-number="11"><span class="co">#&gt; [1] 452</span></a></code></pre></div></li>
<li><p>Explicitly, by calling <code>return()</code>:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">j02 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb68-2" data-line-number="2">  <span class="cf">if</span> (x <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb68-3" data-line-number="3">    <span class="kw">return</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb68-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb68-5" data-line-number="5">    <span class="kw">return</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb68-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb68-7" data-line-number="7">}</a></code></pre></div></li>
</ul>
</div>
<div id="invisible-values" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Invisible values</h3>
<p>Most functions return visibly: calling the function in an interactive context causes the result to be automatically printed.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">j03 &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="dv">1</span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="kw">j03</span>()</a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>However, it’s also possible to return an <code>invisible()</code> value, which is not automatically printed.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">j04 &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="kw">invisible</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="kw">j04</span>()</a></code></pre></div>
<p>You can verify that the value exists either by explicitly printing it or by wrapping in parentheses:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">j04</span>())</a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb71-3" data-line-number="3"></a>
<a class="sourceLine" id="cb71-4" data-line-number="4">(<span class="kw">j04</span>())</a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>Alternatively, use <code>withVisible()</code> to return the value and a visibility flag:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">withVisible</span>(<span class="kw">j04</span>()))</a>
<a class="sourceLine" id="cb72-2" data-line-number="2"><span class="co">#&gt; List of 2</span></a>
<a class="sourceLine" id="cb72-3" data-line-number="3"><span class="co">#&gt;  $ value  : num 1</span></a>
<a class="sourceLine" id="cb72-4" data-line-number="4"><span class="co">#&gt;  $ visible: logi FALSE</span></a></code></pre></div>
<p>The most common function that returns invisibly is <code>&lt;-</code>:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2">(a &lt;-<span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>And this is what makes it possible to chain assignment:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">a &lt;-<span class="st"> </span>b &lt;-<span class="st"> </span>c &lt;-<span class="st"> </span>d &lt;-<span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<p>In general, any function called primarily for its side effects (like <code>&lt;-</code>, <code>print()</code>, or <code>plot()</code>) should return an invisible value (typically the value of the first argument).</p>
</div>
<div id="errors" class="section level3">
<h3><span class="header-section-number">3.6.3</span> Errors</h3>
<p>If a function can not complete its assigned task, it should throw an error with <code>stop()</code>, which immediately terminates the execution of the function.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">j05 &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb75-2" data-line-number="2">  <span class="kw">stop</span>(<span class="st">&quot;I&#39;m an error&quot;</span>)</a>
<a class="sourceLine" id="cb75-3" data-line-number="3">  <span class="kw">return</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb75-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb75-5" data-line-number="5"><span class="kw">j05</span>()</a>
<a class="sourceLine" id="cb75-6" data-line-number="6"><span class="co">#&gt; Error in j05():</span></a>
<a class="sourceLine" id="cb75-7" data-line-number="7"><span class="co">#&gt;   I&#39;m an error</span></a></code></pre></div>
<p>Errors indicate that something has gone wrong, and force the user to handle them. Some languages (like C, go, and rust) rely on special return values to indicate problems, but in R you should always throw an error. You’ll learn more about errors, and how to handle them, in [Conditions].</p>
</div>
<div id="on-exit" class="section level3">
<h3><span class="header-section-number">3.6.4</span> Exit handlers</h3>
<p>Sometimes a function needs to make a temporary change to global state and you want to ensure those changes are restored when the function completes. It’s painful to make sure you cleanup before any explicit return, and what happens if there’s an error? Instead, you can set up an <strong>exiting handler</strong> that is called when the function terminates, regardless of whether it returns a value or throws an error.</p>
<p>To setup an exiting handler, call <code>on.exit()</code> with the code to be run. It will execute when the function exits, regardless of what causes it to exit:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">j06 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb76-2" data-line-number="2">  <span class="kw">cat</span>(<span class="st">&quot;Hello</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb76-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">cat</span>(<span class="st">&quot;Goodbye!</span><span class="ch">\n</span><span class="st">&quot;</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb76-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb76-5" data-line-number="5">  <span class="cf">if</span> (x) {</a>
<a class="sourceLine" id="cb76-6" data-line-number="6">    <span class="kw">return</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb76-7" data-line-number="7">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb76-8" data-line-number="8">    <span class="kw">stop</span>(<span class="st">&quot;Error&quot;</span>)</a>
<a class="sourceLine" id="cb76-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb76-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb76-11" data-line-number="11"></a>
<a class="sourceLine" id="cb76-12" data-line-number="12"><span class="kw">f</span>(<span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb76-13" data-line-number="13"><span class="co">#&gt; [1] 4</span></a>
<a class="sourceLine" id="cb76-14" data-line-number="14"></a>
<a class="sourceLine" id="cb76-15" data-line-number="15"><span class="kw">f</span>(<span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb76-16" data-line-number="16"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<div class="sidebar">
<p>Always set <code>add = TRUE</code> when using <code>on.exit()</code>. If you don’t, each call to <code>on.exit()</code> will overwrite the previous exiting handler. Even when only registering a single handler, it’s good practice to set <code>add = TRUE</code> so that you don’t get an unpleasant surprise if you later add more exit handlers</p>
</div>
<p><code>on.exit()</code> is important because it allows you to place clean-up actions next to actions with their cleanup operations.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">cleanup &lt;-<span class="st"> </span><span class="cf">function</span>(dir, code) {</a>
<a class="sourceLine" id="cb77-2" data-line-number="2">  old_dir &lt;-<span class="st"> </span><span class="kw">setwd</span>(dir)</a>
<a class="sourceLine" id="cb77-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">setwd</span>(old), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb77-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb77-5" data-line-number="5">  old_opt &lt;-<span class="st"> </span><span class="kw">options</span>(<span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb77-6" data-line-number="6">  <span class="kw">on.exit</span>(<span class="kw">options</span>(old_opt), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb77-7" data-line-number="7">}</a></code></pre></div>
<p>When coupled with lazy evaluation, this leads to a very useful pattern for running a block of code in an altered environment:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">with_dir &lt;-<span class="st"> </span><span class="cf">function</span>(dir, code) {</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">  old &lt;-<span class="st"> </span><span class="kw">setwd</span>(dir)</a>
<a class="sourceLine" id="cb78-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">setwd</span>(old), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb78-4" data-line-number="4"></a>
<a class="sourceLine" id="cb78-5" data-line-number="5">  <span class="kw">force</span>(code)</a>
<a class="sourceLine" id="cb78-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb78-7" data-line-number="7"></a>
<a class="sourceLine" id="cb78-8" data-line-number="8"><span class="kw">getwd</span>()</a>
<a class="sourceLine" id="cb78-9" data-line-number="9"><span class="co">#&gt; [1] &quot;D:/RStudio/mybook&quot;</span></a>
<a class="sourceLine" id="cb78-10" data-line-number="10"><span class="kw">with_dir</span>(<span class="st">&quot;~&quot;</span>, <span class="kw">getwd</span>())</a>
<a class="sourceLine" id="cb78-11" data-line-number="11"><span class="co">#&gt; [1] &quot;C:/Users/linchao/Documents&quot;</span></a></code></pre></div>
<p>See the <a href="http://withr.r-lib.org">withr package</a> for a collection of functions of this nature.</p>
<p>In R 3.4 and prior, <code>on.exit()</code> expressions are always run in the order in which they are created:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">  <span class="kw">on.exit</span>(<span class="kw">message</span>(<span class="st">&quot;a&quot;</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">message</span>(<span class="st">&quot;b&quot;</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb79-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb79-5" data-line-number="5"><span class="kw">f</span>()</a>
<a class="sourceLine" id="cb79-6" data-line-number="6"><span class="co">#&gt; a</span></a>
<a class="sourceLine" id="cb79-7" data-line-number="7"><span class="co">#&gt; b</span></a></code></pre></div>
<p>This can make cleanup a little tricky if some actions need to happen in a specific order; typically you want the most recent added expression to be run first. In R 3.5 and later, you can control this by setting <code>after = FALSE</code>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb80-2" data-line-number="2">  <span class="kw">on.exit</span>(<span class="kw">message</span>(<span class="st">&quot;a&quot;</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">after =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb80-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">message</span>(<span class="st">&quot;b&quot;</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">after =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb80-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb80-5" data-line-number="5"><span class="kw">f</span>()</a>
<a class="sourceLine" id="cb80-6" data-line-number="6"><span class="co">#&gt; b</span></a>
<a class="sourceLine" id="cb80-7" data-line-number="7"><span class="co">#&gt; a</span></a></code></pre></div>
</div>
<div id="exercises-4" class="section level3">
<h3><span class="header-section-number">3.6.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What does <code>load()</code> return? Why don’t you normally see these values?</p></li>
<li><p>What does <code>write.table()</code> return? What would be more useful?</p></li>
<li><p>How does the <code>chdir</code> parameter of <code>source()</code> compare to <code>in_dir()</code>? Why
might you prefer one approach to the other?</p></li>
<li><p>Write a function that opens a graphics device, runs the supplied code, and
closes the graphics device (always, regardless of whether or not the plotting
code worked).</p></li>
<li><p>We can use <code>on.exit()</code> to implement a simple version of <code>capture.output()</code>.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">capture.output2 &lt;-<span class="st"> </span><span class="cf">function</span>(code) {</a>
<a class="sourceLine" id="cb81-2" data-line-number="2">  temp &lt;-<span class="st"> </span><span class="kw">tempfile</span>()</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">  <span class="kw">on.exit</span>(<span class="kw">file.remove</span>(temp), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">after =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb81-4" data-line-number="4"></a>
<a class="sourceLine" id="cb81-5" data-line-number="5">  <span class="kw">sink</span>(temp)</a>
<a class="sourceLine" id="cb81-6" data-line-number="6">  <span class="kw">on.exit</span>(<span class="kw">sink</span>(), <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">after =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb81-7" data-line-number="7"></a>
<a class="sourceLine" id="cb81-8" data-line-number="8">  <span class="kw">force</span>(code)</a>
<a class="sourceLine" id="cb81-9" data-line-number="9">  <span class="kw">readLines</span>(temp)</a>
<a class="sourceLine" id="cb81-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb81-11" data-line-number="11"><span class="kw">capture.output2</span>(<span class="kw">cat</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb81-12" data-line-number="12"><span class="co">#&gt; Warning in file.remove(temp): cannot remove file &#39;C:</span></a>
<a class="sourceLine" id="cb81-13" data-line-number="13"><span class="co">#&gt; \Users\linchao\AppData\Local\Temp\RtmpmqqlIO\file2dd7419542650&#39;, reason</span></a>
<a class="sourceLine" id="cb81-14" data-line-number="14"><span class="co">#&gt; &#39;Permission denied&#39;</span></a>
<a class="sourceLine" id="cb81-15" data-line-number="15"><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></a></code></pre></div>
<p>Compare <code>capture.output()</code> to <code>capture.output2()</code>. How do the functions
differ? What features have I removed to make the key ideas easier to see?
How have I rewritten the key ideas to be easier to understand?</p></li>
</ol>
</div>
</div>
<div id="function-forms" class="section level2">
<h2><span class="header-section-number">3.7</span> Function forms</h2>
<blockquote>
<p>&quot;To understand computations in R, two slogans are helpful:</p>
<ul>
<li>Everything that exists is an object.</li>
<li>Everything that happens is a function call.&quot;</li>
</ul>
<p>— John Chambers</p>
</blockquote>
<p>While everything that happens in R is a result of a function call, not all calls look the same. Function calls come in four varieties:</p>
<ul>
<li><p>In <strong>prefix</strong> form, the function name comes before its arguments, like
<code>foofy(a, b, c)</code>. These constitute of the majority of function calls in R.</p></li>
<li><p>In <strong>infix</strong> form, the function name comes inbetween its arguments, like
<code>x + y</code>. Infix forms are used for many mathematical operators, as well as
user-defined functions that begin and end with <code>%</code>.</p></li>
<li><p>A <strong>replacement</strong> function assigns into what looks like a prefix function,
like <code>names(df) &lt;- c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</code>.</p></li>
<li><p><strong>Special forms</strong> like <code>[[</code>, <code>if</code>, and <code>for</code>, don’t have a consistent
structure and provide some of the most important syntax in R.</p></li>
</ul>
<p>While four forms exist, you only need to use one, because any call can be written in prefix form. I’ll demonstrate this property, and then you’ll learn about each of the forms in turn.</p>
<div id="rewriting-to-prefix-form" class="section level3">
<h3><span class="header-section-number">3.7.1</span> Rewriting to prefix form</h3>
<p>}}</p>
<p>An interesting property of R is every infix, replacement, or special form can be rewritten in prefix form. Rewriting in prefix form is useful because it helps you better understand the structure of the language, and it gives you the real name of every function. Knowing the real name of non-prefix functions is useful because it allows you to modify them for fun and profit.</p>
<p>The following example shows three pairs of equivalent calls, rewriting an infix form, replacement form, and a special form into prefix form.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="st">`</span><span class="dt">+</span><span class="st">`</span>(x, y)</a>
<a class="sourceLine" id="cb82-3" data-line-number="3"></a>
<a class="sourceLine" id="cb82-4" data-line-number="4"><span class="kw">names</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>)</a>
<a class="sourceLine" id="cb82-5" data-line-number="5"><span class="st">`</span><span class="dt">names&lt;-</span><span class="st">`</span>(df, <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>))</a>
<a class="sourceLine" id="cb82-6" data-line-number="6"></a>
<a class="sourceLine" id="cb82-7" data-line-number="7"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb82-8" data-line-number="8"><span class="st">`</span><span class="dt">for</span><span class="st">`</span>(i, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="kw">print</span>(i))</a></code></pre></div>
<p>Knowing the function name of a non-prefix function allows you to override its behaviour. For example, if you’re ever feeling particularly evil, run the following code while a friend is away from their computer. It will introduce a fun bug: 10% of the time, 1 will be added to any numeric calculation inside of parentheses.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="st">`</span><span class="dt">(</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(e1) {</a>
<a class="sourceLine" id="cb83-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">is.numeric</span>(e1) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>) {</a>
<a class="sourceLine" id="cb83-3" data-line-number="3">    e1 <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb83-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb83-5" data-line-number="5">    e1</a>
<a class="sourceLine" id="cb83-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb83-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb83-8" data-line-number="8"><span class="kw">replicate</span>(<span class="dv">50</span>, (<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb83-9" data-line-number="9"><span class="co">#&gt;  [1] 3 3 4 3 3 3 3 3 3 3 4 3 3 3 3 4 3 3 3 3 3 3 3 3 4 3 3 3 4 3 3 3 3 3 3</span></a>
<a class="sourceLine" id="cb83-10" data-line-number="10"><span class="co">#&gt; [36] 3 3 3 3 3 3 3 4 3 3 3 3 3 3 3</span></a>
<a class="sourceLine" id="cb83-11" data-line-number="11"><span class="kw">rm</span>(<span class="st">&quot;(&quot;</span>)</a></code></pre></div>
<p>Of course, overriding built-in functions like this is a bad idea, but, as you’ll learn about in [metaprogramming], it’s possible to apply it only to selected code blocks. This provides a clean and elegant approach to writing domain specific languages and translators to other languages.</p>
<p>A more useful technique is to use this knowledge when using functional programming tools. For example, you could use <code>sapply()</code> to add 3 to every element of a list by first defining a function <code>add()</code>, like this:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">add &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, add, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb84-3" data-line-number="3"><span class="co">#&gt;  [1]  4  5  6  7  8  9 10 11 12 13</span></a></code></pre></div>
<p>But we can also get the same effect more simply by relying on the existing <code>+</code> function:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="st">`</span><span class="dt">+</span><span class="st">`</span>, <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="co">#&gt; [1] 4 5 6 7 8</span></a></code></pre></div>
<p>We’ll explore this idea in detail in [functionals].</p>
</div>
<div id="prefix-form-prefix-form" class="section level3">
<h3><span class="header-section-number">3.7.2</span> Prefix form {prefix-form}</h3>
<p>The prefix form is the most common form in R code, and indeed in the majority of programming languages. Prefix calls in R are a little special because you can specify arguments in three ways:</p>
<ul>
<li>By position, like <code>help(mean)</code>.</li>
<li>Using partial matching, like <code>help(to = mean)</code>.</li>
<li>By name, like <code>help(topic = mean)</code>.</li>
</ul>
<p>As illustrated by the following chunk, arguments are matched by exact name, then with unique prefixes, and finally by position.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">k01 &lt;-<span class="st"> </span><span class="cf">function</span>(abcdef, bcde1, bcde2) {</a>
<a class="sourceLine" id="cb86-2" data-line-number="2">  <span class="kw">list</span>(<span class="dt">a =</span> abcdef, <span class="dt">b1 =</span> bcde1, <span class="dt">b2 =</span> bcde2)</a>
<a class="sourceLine" id="cb86-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb86-4" data-line-number="4"><span class="kw">str</span>(<span class="kw">k01</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb86-5" data-line-number="5"><span class="co">#&gt; List of 3</span></a>
<a class="sourceLine" id="cb86-6" data-line-number="6"><span class="co">#&gt;  $ a : num 1</span></a>
<a class="sourceLine" id="cb86-7" data-line-number="7"><span class="co">#&gt;  $ b1: num 2</span></a>
<a class="sourceLine" id="cb86-8" data-line-number="8"><span class="co">#&gt;  $ b2: num 3</span></a>
<a class="sourceLine" id="cb86-9" data-line-number="9"><span class="kw">str</span>(<span class="kw">k01</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">abcdef =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb86-10" data-line-number="10"><span class="co">#&gt; List of 3</span></a>
<a class="sourceLine" id="cb86-11" data-line-number="11"><span class="co">#&gt;  $ a : num 1</span></a>
<a class="sourceLine" id="cb86-12" data-line-number="12"><span class="co">#&gt;  $ b1: num 2</span></a>
<a class="sourceLine" id="cb86-13" data-line-number="13"><span class="co">#&gt;  $ b2: num 3</span></a>
<a class="sourceLine" id="cb86-14" data-line-number="14"></a>
<a class="sourceLine" id="cb86-15" data-line-number="15"><span class="co"># Can abbreviate long argument names:</span></a>
<a class="sourceLine" id="cb86-16" data-line-number="16"><span class="kw">str</span>(<span class="kw">k01</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dt">a =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb86-17" data-line-number="17"><span class="co">#&gt; List of 3</span></a>
<a class="sourceLine" id="cb86-18" data-line-number="18"><span class="co">#&gt;  $ a : num 1</span></a>
<a class="sourceLine" id="cb86-19" data-line-number="19"><span class="co">#&gt;  $ b1: num 2</span></a>
<a class="sourceLine" id="cb86-20" data-line-number="20"><span class="co">#&gt;  $ b2: num 3</span></a>
<a class="sourceLine" id="cb86-21" data-line-number="21"></a>
<a class="sourceLine" id="cb86-22" data-line-number="22"><span class="co"># But this doesn&#39;t work because abbreviation is ambiguous</span></a>
<a class="sourceLine" id="cb86-23" data-line-number="23"><span class="kw">str</span>(<span class="kw">k01</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dt">b =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb86-24" data-line-number="24"><span class="co">#&gt; Error in k01(1, 3, b = 1):</span></a>
<a class="sourceLine" id="cb86-25" data-line-number="25"><span class="co">#&gt;   argument 3 matches multiple formal arguments</span></a></code></pre></div>
<p>Generally, only use positional matching for the first one or two arguments; they will be the most commonly used, and most readers will know what they are. Avoid using positional matching for less commonly used arguments, and never use partial matching. See the tidyverse style guide, <a href="http://style.tidyverse.org/syntax.html#argument-names" class="uri">http://style.tidyverse.org/syntax.html#argument-names</a>, for more advice.</p>
</div>
<div id="infix-functions" class="section level3">
<h3><span class="header-section-number">3.7.3</span> Infix functions</h3>
<p>Infix functions are so called because the function name comes <strong>in</strong>between its arguments, and hence infix functions have two arguments. R comes with a number of built-in infix operators: <code>:</code>, <code>::</code>, <code>:::</code>, <code>$</code>, <code>@</code>, <code>^</code>, <code>*</code>, <code>/</code>, <code>+</code>, <code>-</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>!</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>|</code>, <code>||</code>, <code>~</code>, <code>&lt;-</code>, and <code>&lt;&lt;-</code>. You can also create your own infix functions that start and end with <code>%</code>, and base R uses this to additionally define <code>%%</code>, <code>%*%</code>, <code>%/%</code>, <code>%in%</code>, <code>%o%</code>, and <code>%x%</code>.</p>
<p>Defining your own infix function is simple. You create a two argument function and bind it to a name that starts and ends with <code>%</code>:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="st">`</span><span class="dt">%+%</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) <span class="kw">paste0</span>(a, b)</a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="st">&quot;new &quot;</span> <span class="op">%+%</span><span class="st"> &quot;string&quot;</span></a>
<a class="sourceLine" id="cb87-3" data-line-number="3"><span class="co">#&gt; [1] &quot;new string&quot;</span></a></code></pre></div>
<p>The names of infix functions are more flexible than regular R functions: they can contain any sequence of characters except “%”. You will need to escape any special characters in the string used to define the function, but not when you call it:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"><span class="st">`</span><span class="dt">% %</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) <span class="kw">paste</span>(a, b)</a>
<a class="sourceLine" id="cb88-2" data-line-number="2"><span class="st">`</span><span class="dt">%/</span><span class="ch">\\</span><span class="dt">%</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) <span class="kw">paste</span>(a, b)</a>
<a class="sourceLine" id="cb88-3" data-line-number="3"></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="st">&quot;a&quot;</span> <span class="op">% %</span><span class="st"> &quot;b&quot;</span></a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="co">#&gt; [1] &quot;a b&quot;</span></a>
<a class="sourceLine" id="cb88-6" data-line-number="6"><span class="st">&quot;a&quot;</span> <span class="op">%/\%</span><span class="st"> &quot;b&quot;</span></a>
<a class="sourceLine" id="cb88-7" data-line-number="7"><span class="co">#&gt; [1] &quot;a b&quot;</span></a></code></pre></div>
<p>R’s default precedence rules mean that infix operators are composed from left to right:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="st">`</span><span class="dt">%-%</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) <span class="kw">paste0</span>(<span class="st">&quot;(&quot;</span>, a, <span class="st">&quot; %-% &quot;</span>, b, <span class="st">&quot;)&quot;</span>)</a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="st">&quot;a&quot;</span> <span class="op">%-%</span><span class="st"> &quot;b&quot;</span> <span class="op">%-%</span><span class="st"> &quot;c&quot;</span></a>
<a class="sourceLine" id="cb89-3" data-line-number="3"><span class="co">#&gt; [1] &quot;((a %-% b) %-% c)&quot;</span></a></code></pre></div>
<p>There are two special infix functions that can be called with a single argument: <code>+</code> and <code>-</code>.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="dv">-1</span></a>
<a class="sourceLine" id="cb90-2" data-line-number="2"><span class="co">#&gt; [1] -1</span></a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="op">+</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb90-4" data-line-number="4"><span class="co">#&gt; [1] 10</span></a></code></pre></div>
</div>
<div id="replacement-functions" class="section level3">
<h3><span class="header-section-number">3.7.4</span> Replacement functions</h3>
<p>Replacement functions act like they modify their arguments in place, and have the special name <code>xxx&lt;-</code>. They must have arguments named <code>x</code> and <code>value</code>, and must return the modified object. For example, the following function allows you to modify the second element of a vector:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="st">`</span><span class="dt">second&lt;-</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x, value) {</a>
<a class="sourceLine" id="cb91-2" data-line-number="2">  x[<span class="dv">2</span>] &lt;-<span class="st"> </span>value</a>
<a class="sourceLine" id="cb91-3" data-line-number="3">  x</a>
<a class="sourceLine" id="cb91-4" data-line-number="4">}</a></code></pre></div>
<p>Replacement functions are used by placing the function call on the LHS of <code>&lt;-</code>:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="kw">second</span>(x) &lt;-<span class="st"> </span>5L</a>
<a class="sourceLine" id="cb92-3" data-line-number="3">x</a>
<a class="sourceLine" id="cb92-4" data-line-number="4"><span class="co">#&gt;  [1]  1  5  3  4  5  6  7  8  9 10</span></a></code></pre></div>
<p>I say they “act” like they modify their arguments in place, because, as discussed in [Modify-in-place], they actually create a modified copy. We can see that by using <code>tracemem()</code>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="kw">tracemem</span>(x)</a>
<a class="sourceLine" id="cb93-3" data-line-number="3"><span class="co">#&gt; &lt;0x7ffae71bd880&gt;</span></a>
<a class="sourceLine" id="cb93-4" data-line-number="4"></a>
<a class="sourceLine" id="cb93-5" data-line-number="5"><span class="kw">second</span>(x) &lt;-<span class="st"> </span>6L</a>
<a class="sourceLine" id="cb93-6" data-line-number="6"><span class="co">#&gt; tracemem[0x7ffae71bd880 -&gt; 0x7ffae61b5480]: </span></a>
<a class="sourceLine" id="cb93-7" data-line-number="7"><span class="co">#&gt; tracemem[0x7ffae61b5480 -&gt; 0x7ffae73f0408]: second&lt;- </span></a></code></pre></div>
<p>If you want to supply additional arguments, they go inbetween <code>x</code> and <code>value</code>:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="st">`</span><span class="dt">modify&lt;-</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x, position, value) {</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">  x[position] &lt;-<span class="st"> </span>value</a>
<a class="sourceLine" id="cb94-3" data-line-number="3">  x</a>
<a class="sourceLine" id="cb94-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb94-5" data-line-number="5"><span class="kw">modify</span>(x, <span class="dv">1</span>) &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb94-6" data-line-number="6">x</a>
<a class="sourceLine" id="cb94-7" data-line-number="7"><span class="co">#&gt;  [1] 10  5  3  4  5  6  7  8  9 10</span></a></code></pre></div>
<p>When you write <code>modify(x, 1) &lt;- 10</code>, behind the scenes R turns it into:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">x &lt;-<span class="st"> `</span><span class="dt">modify&lt;-</span><span class="st">`</span>(x, <span class="dv">1</span>, <span class="dv">10</span>)</a></code></pre></div>
<p>Combining replacement with other functions requires more complex translation. For example, this:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="kw">names</span>(x)</a>
<a class="sourceLine" id="cb96-3" data-line-number="3"><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></a>
<a class="sourceLine" id="cb96-4" data-line-number="4"></a>
<a class="sourceLine" id="cb96-5" data-line-number="5"><span class="kw">names</span>(x)[<span class="dv">2</span>] &lt;-<span class="st"> &quot;two&quot;</span></a>
<a class="sourceLine" id="cb96-6" data-line-number="6"><span class="kw">names</span>(x)</a>
<a class="sourceLine" id="cb96-7" data-line-number="7"><span class="co">#&gt; [1] &quot;a&quot;   &quot;two&quot; &quot;c&quot;</span></a></code></pre></div>
<p>Is translated into:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span> &lt;-<span class="st"> </span>x</a>
<a class="sourceLine" id="cb97-2" data-line-number="2">x &lt;-<span class="st"> `</span><span class="dt">names&lt;-</span><span class="st">`</span>(<span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span>, <span class="st">`</span><span class="dt">[&lt;-</span><span class="st">`</span>(<span class="kw">names</span>(<span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span>), <span class="dv">2</span>, <span class="st">&quot;two&quot;</span>))</a>
<a class="sourceLine" id="cb97-3" data-line-number="3"><span class="kw">rm</span>(<span class="st">`</span><span class="dt">*tmp*</span><span class="st">`</span>)</a></code></pre></div>
<p>(Yes, it really does create a local variable named <em>tmp</em>, which is removed afterwards.)</p>
</div>
<div id="special-forms" class="section level3">
<h3><span class="header-section-number">3.7.5</span> Special forms</h3>
<p>Finally, there are a bunch of language features that are usually written in special ways, but also have prefix forms. These include parentheses:</p>
<ul>
<li><code>(x)</code> (<code>`(`(x)</code>)</li>
<li><code>{x}</code> (<code>`{`(x)</code>).</li>
</ul>
<p>The subsetting operators:</p>
<ul>
<li><code>x[i]</code> (<code>`[`(x, i)</code>)</li>
<li><code>x[[i]]</code> (<code>`[[`(x, i)</code>)</li>
</ul>
<p>And the tools of control flow:</p>
<ul>
<li><code>if (cond) true</code> (<code>`if`(cond, true)</code>)</li>
<li><code>if (cond) true else false</code> (<code>`if`(cond, true, false)</code>)</li>
<li><code>for(var in seq) action</code> (<code>`for`(var, seq, action)</code>)</li>
<li><code>while(cond) action</code> (<code>`while`(cond, action)</code>)</li>
<li><code>repeat expr</code> (<code>`repeat`(expr)</code>)</li>
<li><code>next</code> (<code>`next`()</code>)</li>
<li><code>break</code> (<code>`break`()</code>)</li>
</ul>
<p>Finally, the most complex is the “function” function:</p>
<ul>
<li><code>function(arg1, arg2) {body}</code> (<code>`function`(alist(arg1, arg2), body, env)</code>)</li>
</ul>
<p>Knowing the name of the function that underlies the special form is useful for getting documentation. <code>?(</code> is a syntax error; <code>?`(`</code> will give you the documentation for parentheses.</p>
<p>Note that all special forms are implemented as primitive functions (i.e. in C); that means printing these functions is not informative:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="st">`</span><span class="dt">for</span><span class="st">`</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="co">#&gt; .Primitive(&quot;for&quot;)</span></a></code></pre></div>
</div>
</div>
<div id="invoking-a-function" class="section level2">
<h2><span class="header-section-number">3.8</span> Invoking a function</h2>
<p>Suppose you had a list of function arguments:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">args &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>How could you then send that list to <code>mean()</code>? In base R, you need <code>do.call()</code>:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">do.call</span>(mean, args)</a>
<a class="sourceLine" id="cb100-2" data-line-number="2"><span class="co">#&gt; [1] 5.5</span></a>
<a class="sourceLine" id="cb100-3" data-line-number="3"><span class="co"># Equivalent to</span></a>
<a class="sourceLine" id="cb100-4" data-line-number="4"><span class="kw">mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb100-5" data-line-number="5"><span class="co">#&gt; [1] 5.5</span></a></code></pre></div>
<div id="exercises-5" class="section level3">
<h3><span class="header-section-number">3.8.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Rewrite the following code snippets into prefix form:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"></a>
<a class="sourceLine" id="cb101-3" data-line-number="3"><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb101-4" data-line-number="4"></a>
<a class="sourceLine" id="cb101-5" data-line-number="5"><span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">5</span>) x[[<span class="dv">5</span>]] <span class="cf">else</span> x[[n]]</a></code></pre></div></li>
<li><p>Clarify the following list of odd function calls:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dv">20</span>, <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb102-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>, <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb102-3" data-line-number="3"><span class="kw">cor</span>(<span class="dt">m =</span> <span class="st">&quot;k&quot;</span>, <span class="dt">y =</span> y, <span class="dt">u =</span> <span class="st">&quot;p&quot;</span>, <span class="dt">x =</span> x)</a></code></pre></div></li>
<li><p>Explain why the following code fails:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">modify</span>(<span class="kw">get</span>(<span class="st">&quot;x&quot;</span>), <span class="dv">1</span>) &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb103-2" data-line-number="2"><span class="co">#&gt; Error: target of assignment expands to non-language object</span></a></code></pre></div></li>
<li><p>Create a replacement function that modifies a random location in a vector.</p></li>
<li><p>Write your own version of <code>+</code> that will paste its inputs together if
they are character vectors but behaves as usual otherwise. In other words,
make this code work:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb104-3" data-line-number="3"></a>
<a class="sourceLine" id="cb104-4" data-line-number="4"><span class="st">&quot;a&quot;</span> <span class="op">+</span><span class="st"> &quot;b&quot;</span></a>
<a class="sourceLine" id="cb104-5" data-line-number="5"><span class="co">#&gt; [1] &quot;ab&quot;</span></a></code></pre></div></li>
<li><p>Create a list of all the replacement functions found in the base package.
Which ones are primitive functions? (Hint use <code>apropros()</code>)</p></li>
<li><p>What are valid names for user-created infix functions?</p></li>
<li><p>Create an infix <code>xor()</code> operator.</p></li>
<li><p>Create infix versions of the set functions <code>intersect()</code>, <code>union()</code>, and
<code>setdiff()</code>. You might call them <code>%n%</code>, <code>%u%</code>, and <code>%/%</code> to match
conventions from mathematics.</p></li>
</ol>
</div>
</div>
<div id="function-answers" class="section level2">
<h2><span class="header-section-number">3.9</span> Quiz answers</h2>
<ol style="list-style-type: decimal">
<li><p>The three components of a function are its body, arguments, and environment.</p></li>
<li><p><code>f1(1)()</code> returns 11.</p></li>
<li><p>You’d normally write it in infix style: <code>1 + (2 * 3)</code>.</p></li>
<li><p>Rewriting the call to <code>mean(c(1:10, NA), na.rm = TRUE)</code> is easier to
understand.</p></li>
<li><p>No, it does not throw an error because the second argument is never used
so it’s never evaluated.</p></li>
<li><p>See <a href="functions.html#infix-functions">infix</a> and
<a href="functions.html#replacement-functions">replacement functions</a>.</p></li>
<li><p>You use <code>on.exit()</code>; see <a href="functions.html#on-exit">on exit</a> for details.</p></li>
</ol>

</div>
<div id="quick-view" class="section level2">
<h2><span class="header-section-number">3.10</span> quick view</h2>
<p>測試資料
可以先看看資料描述 <code>?mtcars</code></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">mtcars</a>
<a class="sourceLine" id="cb105-2" data-line-number="2"><span class="co">#&gt;                      mpg cyl  disp  hp drat   wt qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="co">#&gt; Mazda RX4           21.0   6 160.0 110 3.90 2.62 16.5  0  1    4    4</span></a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="co">#&gt; Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.88 17.0  0  1    4    4</span></a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="co">#&gt; Datsun 710          22.8   4 108.0  93 3.85 2.32 18.6  1  1    4    1</span></a>
<a class="sourceLine" id="cb105-6" data-line-number="6"><span class="co">#&gt; Hornet 4 Drive      21.4   6 258.0 110 3.08 3.21 19.4  1  0    3    1</span></a>
<a class="sourceLine" id="cb105-7" data-line-number="7"><span class="co">#&gt; Hornet Sportabout   18.7   8 360.0 175 3.15 3.44 17.0  0  0    3    2</span></a>
<a class="sourceLine" id="cb105-8" data-line-number="8"><span class="co">#&gt; Valiant             18.1   6 225.0 105 2.76 3.46 20.2  1  0    3    1</span></a>
<a class="sourceLine" id="cb105-9" data-line-number="9"><span class="co">#&gt; Duster 360          14.3   8 360.0 245 3.21 3.57 15.8  0  0    3    4</span></a>
<a class="sourceLine" id="cb105-10" data-line-number="10"><span class="co">#&gt; Merc 240D           24.4   4 146.7  62 3.69 3.19 20.0  1  0    4    2</span></a>
<a class="sourceLine" id="cb105-11" data-line-number="11"><span class="co">#&gt; Merc 230            22.8   4 140.8  95 3.92 3.15 22.9  1  0    4    2</span></a>
<a class="sourceLine" id="cb105-12" data-line-number="12"><span class="co">#&gt; Merc 280            19.2   6 167.6 123 3.92 3.44 18.3  1  0    4    4</span></a>
<a class="sourceLine" id="cb105-13" data-line-number="13"><span class="co">#&gt; Merc 280C           17.8   6 167.6 123 3.92 3.44 18.9  1  0    4    4</span></a>
<a class="sourceLine" id="cb105-14" data-line-number="14"><span class="co">#&gt; Merc 450SE          16.4   8 275.8 180 3.07 4.07 17.4  0  0    3    3</span></a>
<a class="sourceLine" id="cb105-15" data-line-number="15"><span class="co">#&gt; Merc 450SL          17.3   8 275.8 180 3.07 3.73 17.6  0  0    3    3</span></a>
<a class="sourceLine" id="cb105-16" data-line-number="16"><span class="co">#&gt; Merc 450SLC         15.2   8 275.8 180 3.07 3.78 18.0  0  0    3    3</span></a>
<a class="sourceLine" id="cb105-17" data-line-number="17"><span class="co">#&gt; Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.25 18.0  0  0    3    4</span></a>
<a class="sourceLine" id="cb105-18" data-line-number="18"><span class="co">#&gt; Lincoln Continental 10.4   8 460.0 215 3.00 5.42 17.8  0  0    3    4</span></a>
<a class="sourceLine" id="cb105-19" data-line-number="19"><span class="co">#&gt; Chrysler Imperial   14.7   8 440.0 230 3.23 5.34 17.4  0  0    3    4</span></a>
<a class="sourceLine" id="cb105-20" data-line-number="20"><span class="co">#&gt; Fiat 128            32.4   4  78.7  66 4.08 2.20 19.5  1  1    4    1</span></a>
<a class="sourceLine" id="cb105-21" data-line-number="21"><span class="co">#&gt; Honda Civic         30.4   4  75.7  52 4.93 1.61 18.5  1  1    4    2</span></a>
<a class="sourceLine" id="cb105-22" data-line-number="22"><span class="co">#&gt; Toyota Corolla      33.9   4  71.1  65 4.22 1.83 19.9  1  1    4    1</span></a>
<a class="sourceLine" id="cb105-23" data-line-number="23"><span class="co">#&gt; Toyota Corona       21.5   4 120.1  97 3.70 2.46 20.0  1  0    3    1</span></a>
<a class="sourceLine" id="cb105-24" data-line-number="24"><span class="co">#&gt; Dodge Challenger    15.5   8 318.0 150 2.76 3.52 16.9  0  0    3    2</span></a>
<a class="sourceLine" id="cb105-25" data-line-number="25"><span class="co">#&gt; AMC Javelin         15.2   8 304.0 150 3.15 3.44 17.3  0  0    3    2</span></a>
<a class="sourceLine" id="cb105-26" data-line-number="26"><span class="co">#&gt; Camaro Z28          13.3   8 350.0 245 3.73 3.84 15.4  0  0    3    4</span></a>
<a class="sourceLine" id="cb105-27" data-line-number="27"><span class="co">#&gt; Pontiac Firebird    19.2   8 400.0 175 3.08 3.85 17.1  0  0    3    2</span></a>
<a class="sourceLine" id="cb105-28" data-line-number="28"><span class="co">#&gt; Fiat X1-9           27.3   4  79.0  66 4.08 1.94 18.9  1  1    4    1</span></a>
<a class="sourceLine" id="cb105-29" data-line-number="29"><span class="co">#&gt; Porsche 914-2       26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2</span></a>
<a class="sourceLine" id="cb105-30" data-line-number="30"><span class="co">#&gt; Lotus Europa        30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2</span></a>
<a class="sourceLine" id="cb105-31" data-line-number="31"><span class="co">#&gt; Ford Pantera L      15.8   8 351.0 264 4.22 3.17 14.5  0  1    5    4</span></a>
<a class="sourceLine" id="cb105-32" data-line-number="32"><span class="co">#&gt; Ferrari Dino        19.7   6 145.0 175 3.62 2.77 15.5  0  1    5    6</span></a>
<a class="sourceLine" id="cb105-33" data-line-number="33"><span class="co">#&gt; Maserati Bora       15.0   8 301.0 335 3.54 3.57 14.6  0  1    5    8</span></a>
<a class="sourceLine" id="cb105-34" data-line-number="34"><span class="co">#&gt; Volvo 142E          21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2</span></a>
<a class="sourceLine" id="cb105-35" data-line-number="35"><span class="kw">head</span>(mtcars)</a>
<a class="sourceLine" id="cb105-36" data-line-number="36"><span class="co">#&gt;                    mpg cyl disp  hp drat   wt qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb105-37" data-line-number="37"><span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.62 16.5  0  1    4    4</span></a>
<a class="sourceLine" id="cb105-38" data-line-number="38"><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.88 17.0  0  1    4    4</span></a>
<a class="sourceLine" id="cb105-39" data-line-number="39"><span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.32 18.6  1  1    4    1</span></a>
<a class="sourceLine" id="cb105-40" data-line-number="40"><span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.21 19.4  1  0    3    1</span></a>
<a class="sourceLine" id="cb105-41" data-line-number="41"><span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.44 17.0  0  0    3    2</span></a>
<a class="sourceLine" id="cb105-42" data-line-number="42"><span class="co">#&gt; Valiant           18.1   6  225 105 2.76 3.46 20.2  1  0    3    1</span></a>
<a class="sourceLine" id="cb105-43" data-line-number="43"><span class="kw">tail</span>(mtcars)</a>
<a class="sourceLine" id="cb105-44" data-line-number="44"><span class="co">#&gt;                 mpg cyl  disp  hp drat   wt qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb105-45" data-line-number="45"><span class="co">#&gt; Porsche 914-2  26.0   4 120.3  91 4.43 2.14 16.7  0  1    5    2</span></a>
<a class="sourceLine" id="cb105-46" data-line-number="46"><span class="co">#&gt; Lotus Europa   30.4   4  95.1 113 3.77 1.51 16.9  1  1    5    2</span></a>
<a class="sourceLine" id="cb105-47" data-line-number="47"><span class="co">#&gt; Ford Pantera L 15.8   8 351.0 264 4.22 3.17 14.5  0  1    5    4</span></a>
<a class="sourceLine" id="cb105-48" data-line-number="48"><span class="co">#&gt; Ferrari Dino   19.7   6 145.0 175 3.62 2.77 15.5  0  1    5    6</span></a>
<a class="sourceLine" id="cb105-49" data-line-number="49"><span class="co">#&gt; Maserati Bora  15.0   8 301.0 335 3.54 3.57 14.6  0  1    5    8</span></a>
<a class="sourceLine" id="cb105-50" data-line-number="50"><span class="co">#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.78 18.6  1  1    4    2</span></a></code></pre></div>
<div id="section-3.10.1" class="section level3">
<h3><span class="header-section-number">3.10.1</span> 編輯/瀏覽資料</h3>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">edit</span>(mtcars)</a>
<a class="sourceLine" id="cb106-2" data-line-number="2"><span class="kw">data.entry</span>(mtcars)</a>
<a class="sourceLine" id="cb106-3" data-line-number="3"><span class="kw">View</span>(mtcars)</a></code></pre></div>
</div>
<div id="section-3.10.2" class="section level3">
<h3><span class="header-section-number">3.10.2</span> 個別欄位</h3>
<p>如果要顯示個別欄位,一般可以是<code>mtcars$mpg</code>,但是如果要直接使用<code>mpg</code>欄位,可以利用<code>attach()</code></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">attach</span>(mtcars)</a>
<a class="sourceLine" id="cb107-2" data-line-number="2">mpg</a>
<a class="sourceLine" id="cb107-3" data-line-number="3"><span class="co">#&gt;  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2</span></a>
<a class="sourceLine" id="cb107-4" data-line-number="4"><span class="co">#&gt; [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4</span></a>
<a class="sourceLine" id="cb107-5" data-line-number="5"><span class="co">#&gt; [29] 15.8 19.7 15.0 21.4</span></a></code></pre></div>
</div>
<div id="section-3.10.3" class="section level3">
<h3><span class="header-section-number">3.10.3</span> 質性數據的分析</h3>
<p>欄位<code>cyl</code>為質性變數,可以利用table分析</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">table</span>(mtcars<span class="op">$</span>cyl)</a>
<a class="sourceLine" id="cb108-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb108-3" data-line-number="3"><span class="co">#&gt;  4  6  8 </span></a>
<a class="sourceLine" id="cb108-4" data-line-number="4"><span class="co">#&gt; 11  7 14</span></a></code></pre></div>
<p>頻率圖</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(mtcars<span class="op">$</span>cyl))</a></code></pre></div>
<p><img src="rmi_copy_test_files/figure-html/unnamed-chunk-118-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sidebar">
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1">v&lt;-<span class="kw">as.vector</span>(<span class="kw">table</span>(mtcars<span class="op">$</span>cyl))</a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="kw">barplot</span>(v)</a>
<a class="sourceLine" id="cb110-3" data-line-number="3">m&lt;-<span class="kw">as.matrix</span>(<span class="kw">table</span>(mtcars<span class="op">$</span>cyl))</a>
<a class="sourceLine" id="cb110-4" data-line-number="4"><span class="kw">barplot</span>(m)</a>
<a class="sourceLine" id="cb110-5" data-line-number="5"></a>
<a class="sourceLine" id="cb110-6" data-line-number="6"><span class="kw">barplot</span>(<span class="kw">c</span>(<span class="dv">11</span>,<span class="dv">7</span>,<span class="dv">4</span>))</a></code></pre></div>
<p><img src="rmi_copy_test_files/figure-html/unnamed-chunk-119-1.png" width="70%" style="display: block; margin: auto;" /><img src="rmi_copy_test_files/figure-html/unnamed-chunk-119-2.png" width="70%" style="display: block; margin: auto;" /><img src="rmi_copy_test_files/figure-html/unnamed-chunk-119-3.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw">barplot</span>(mtcars<span class="op">$</span>mpg)</a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="kw">barplot</span>(mtcars<span class="op">$</span>cyl)</a></code></pre></div>
<p><img src="rmi_copy_test_files/figure-html/unnamed-chunk-120-1.png" width="70%" style="display: block; margin: auto;" /><img src="rmi_copy_test_files/figure-html/unnamed-chunk-120-2.png" width="70%" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p><code>20</code>.<a href="functions.html#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Functions that automatically quote one or more arguments (sometimes called NSE functions) can override the default scoping rules to implement other varieties of scoping. You’ll learn more about that in <a href="#meta">metaprogramming</a>.<a href="functions.html#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p><code>g04()</code> returns <code>c(1, 2, 3)</code>.<a href="functions.html#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p><code>g06()</code> returns <code>c(10, 2)</code>.<a href="functions.html#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p><code>g11()</code> 每次被調用都是傳回 <code>1</code>。.<a href="functions.html#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p>Note that this only implements one way of calling <code>sample()</code>: you can also call it with a single integer, like <code>sample(10)</code>. This unfortunately makes <code>sample()</code> prone to silent errors in situations like <code>sample(x[i])</code>.<a href="functions.html#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p>Functions can exit in other more esoteric ways like signalling a condition that is caught by an exiting handler, invoking a restart, or pressing “Q” in an interactive browser.<a href="functions.html#fnref7" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="file-system.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="r-packages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/Function.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
